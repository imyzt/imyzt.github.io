<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://imyzt.top</id>
    <title>æ¨é•‡æ¶›çš„ä¸€äº©ä¸‰åˆ†åœ°</title>
    <updated>2025-09-25T01:40:58.803Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://imyzt.top"/>
    <link rel="self" href="https://imyzt.top/atom.xml"/>
    <subtitle>åˆ†äº«æˆ‘çš„æŠ€æœ¯å’Œç”Ÿæ´»</subtitle>
    <logo>https://imyzt.top/images/avatar.png</logo>
    <icon>https://imyzt.top/favicon.ico</icon>
    <rights>All rights reserved 2025, æ¨é•‡æ¶›çš„ä¸€äº©ä¸‰åˆ†åœ°</rights>
    <entry>
        <title type="html"><![CDATA[MCPåˆä½“éªŒï¼ŒTraeæ¥å…¥MySQL MCP Server]]></title>
        <id>https://imyzt.top/post/mcp-chu-ti-yan-trae-jie-ru-mysql-mcp-server/</id>
        <link href="https://imyzt.top/post/mcp-chu-ti-yan-trae-jie-ru-mysql-mcp-server/">
        </link>
        <updated>2025-06-07T02:55:12.000Z</updated>
        <content type="html"><![CDATA[<p>å…³äº <code>MCP</code> æ˜¯ä»€ä¹ˆå°±ä¸åœ¨æ­¤èµ˜è¿°ï¼Œå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://docs.trae.com.cn/ide/model-context-protocol">æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰<br>
</a>ï¼Œç›®å‰ <code>Trae</code> å·²ç»æ”¯æŒ <code>MCP</code>ï¼Œç½‘ä¸Šè¿˜æ²¡æœ‰ä»€ä¹ˆæ•™ç¨‹ï¼Œæœ¬æ–‡è®°å½•ä¸‹è‡ªå·±å®‰è£…çš„è¿‡ç¨‹ã€‚</p>
<h1 id="1-é¦–å…ˆå®‰è£…-trae-æµ·å¤–ç‰ˆ">1. é¦–å…ˆå®‰è£… Trae æµ·å¤–ç‰ˆ</h1>
<p><a href="https://www.trae.ai/">https://www.trae.ai/</a></p>
<h1 id="2-åœ¨-chat-ä¸­é€šè¿‡-å”¤èµ·-æ·»åŠ æ™ºèƒ½ä½“">2. åœ¨ <code>Chat</code> ä¸­é€šè¿‡ <code>@</code> å”¤èµ·: <code>æ·»åŠ æ™ºèƒ½ä½“</code></h1>
<p>æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ·»åŠ ä¸€ä¸ª <code>MCP Server</code>ï¼Œæ­¤å¤„ä»¥ <code>MySQL MCP Server</code> ä¸ºä¾‹ã€‚</p>
<p><img src="https://imyzt.top/post-images/1749265319195.png" alt="" loading="lazy"><br>
<img src="https://imyzt.top/post-images/1749265326233.png" alt="" loading="lazy"><br>
<img src="https://imyzt.top/post-images/1749265331930.png" alt="" loading="lazy"><br>
<img src="https://imyzt.top/post-images/1749265337881.png" alt="" loading="lazy"></p>
<h1 id="3-æ ¹æ®-mysql-mcp-server-çš„-github-page-é¡µé¢å®‰è£…ä¾èµ–">3. æ ¹æ® MySQL MCP Server çš„ Github Page é¡µé¢å®‰è£…ä¾èµ–</h1>
<p>å®‰è£…å®Œæˆåï¼Œç‚¹å‡»ä¸Šå›¾é¢„è§ˆï¼Œå³å¯æ‰“å¼€GithubæŸ¥çœ‹è¯¥MCP Serverçš„å®‰è£…æ•™ç¨‹ã€‚<br>
<img src="https://imyzt.top/post-images/1749265511011.png" alt="" loading="lazy"></p>
<p>å®˜æ–¹ä½¿ç”¨ <code>pip install mysql-mcp-server</code> è¿›è¡Œå®‰è£…ï¼Œä½†æˆ‘å®‰è£…è€æ˜¯å¤±è´¥ï¼Œé€šè¿‡æœç´¢issueï¼Œå‘ç°ä¹Ÿæœ‰ç±»ä¼¼çš„æƒ…å†µï¼Œ <a href="https://github.com/designcomputer/mysql_mcp_server/issues/33">issue</a> å»ºè®®ä½¿ç”¨ <code>uv pip install mysql-mcp-server</code> è¿›è¡Œå®‰è£…ï¼Œæˆ‘åˆ‡æ¢ä¸º <code>uv</code> ä¹‹åå°±å®‰è£…æˆåŠŸäº†ã€‚</p>
<h1 id="4-é…ç½®-mcp-server">4. é…ç½® MCP Server</h1>
<p><img src="https://imyzt.top/post-images/1749265854609.png" alt="" loading="lazy"><br>
ç‚¹å‡»ç¼–è¾‘æŒ‰é’®ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <code>uv</code> å®‰è£…çš„ <code>MySQL MCP Server</code>ï¼Œæ‰€ä»¥éœ€è¦å°†ä¸‹é¢çš„JSONæ›¿æ¢æ‰å®˜æ–¹çš„é»˜è®¤JSONï¼Œç„¶åæ›¿æ¢è‡ªå·±çš„æ•°æ®åº“ä¿¡æ¯ã€‚</p>
<pre><code class="language-json">{
  &quot;mcpServers&quot;: {
    &quot;MySQL Server&quot;: {
      &quot;command&quot;: &quot;uvx&quot;,
      &quot;args&quot;: [
        &quot;--from&quot;,
        &quot;mysql-mcp-server&quot;,
        &quot;mysql_mcp_server&quot;
      ],
      &quot;env&quot;: {
        &quot;MYSQL_DATABASE&quot;: &quot;dbname&quot;,
        &quot;MYSQL_HOST&quot;: &quot;host&quot;,
        &quot;MYSQL_PASSWORD&quot;: &quot;password&quot;,
        &quot;MYSQL_PORT&quot;: &quot;3306&quot;,
        &quot;MYSQL_USER&quot;: &quot;username&quot;
      }
    }
  }
}
</code></pre>
<h1 id="5-ä½¿ç”¨mcp">5. ä½¿ç”¨MCP</h1>
<p>é…ç½®ä¸Šé¢çš„ä¿¡æ¯åï¼Œå°±å¯ä»¥åœ¨ Chat ä¸­å’Œ MCP è¿›è¡Œå¯¹è¯äº†ï¼Œä»–ä¼šååŠ©æˆ‘ä»¬æŸ¥è¯¢æ•°æ®åº“ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://imyzt.top/post-images/1749266042790.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="2"><img src="https://imyzt.top/post-images/1749266277703.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[åœ¨IDEAä¸­ç®¡ç†å’Œç›‘å¬arthasåº”ç”¨]]></title>
        <id>https://imyzt.top/post/zai-idea-zhong-guan-li-he-jian-ting-arthas-ying-yong/</id>
        <link href="https://imyzt.top/post/zai-idea-zhong-guan-li-he-jian-ting-arthas-ying-yong/">
        </link>
        <updated>2024-10-13T09:53:32.000Z</updated>
        <content type="html"><![CDATA[<p>è¿‘æœŸå’Œarthas-idea-pluginæ’ä»¶ç¤¾åŒºæ²Ÿé€šï¼Œä¸ºæ’ä»¶è´¡çŒ®äº†éƒ¨åˆ†åŠŸèƒ½ï¼Œä¸‹æ–‡ä¸ºå…¨æ–‡è½¬è½½ï¼š<br>
åŸæ–‡é“¾æ¥ï¼š<a href="https://www.yuque.com/arthas-idea-plugin/help/oo75vhvqs6n9gof8?singleDoc#">ã€Šåœ¨IDEAä¸­ç®¡ç†å’Œç›‘å¬arthasåº”ç”¨ã€‹</a></p>
<p><code>arthas idea plugin</code> æ’ä»¶æ–¹ä¾¿äº†æˆ‘ä»¬ä½¿ç”¨ <code>Arthas</code>ï¼Œå¯¹äºå‘½ä»¤ä¸ç†Ÿæ‚‰åŒå­¦ä¹Ÿå¯ä»¥å¿«é€Ÿä¸Šæ‰‹æ’æŸ¥é—®é¢˜ã€‚ä½†æ˜¯å½“ä¸€ä¸ªåº”ç”¨æœ‰å¤šä¸ªå®ä¾‹æ—¶ï¼Œä¸ºäº†ç›‘å¬æŸä¸€ä¸ªè¯·æ±‚æˆ‘ä»¬é€šå¸¸ä¼šæ‰“å¼€å¤šä¸ªæµè§ˆå™¨çª—å£æ¥å¯åŠ¨ç›‘å¬ï¼Œä½¿ç”¨èµ·æ¥å¤šå°‘æœ‰ç‚¹ä¸æ–¹ä¾¿ã€‚æ•…æ‰©å±•äº†åœ¨ <code>IDEA</code> å†…éƒ¨ç›´æ¥ç›‘å¬çš„åŠŸèƒ½ã€‚ç¤¾åŒºå†…ç›¸å…³ Issueï¼š<a href="https://github.com/WangJi92/arthas-idea-plugin/issues/92">https://github.com/WangJi92/arthas-idea-plugin/issues/92</a></p>
<p>å¦‚æœå›¢é˜Ÿçš„å·¥ä½œæ¨¡å¼æ˜¯è¿›å…¥å®¿ä¸»æœºæ‰‹åŠ¨å¯åŠ¨<code>Arthas</code>å‘½ä»¤æ¥ç›‘å¬æœ¬æœºåº”ç”¨ï¼Œé‚£ä¹ˆè¯¥æ’ä»¶å¹¶ä¸èƒ½å¸®åŠ©åˆ°è¿™éƒ¨åˆ†ç”¨æˆ·ã€‚æ’ä»¶é€‚ç”¨çš„å·¥ä½œæ¨¡å¼æ˜¯ä½¿ç”¨<code>Tunnel-Server</code>å’Œ<code>arthas-spring-boot-starter</code>ï¼Œå°†åº”ç”¨æ³¨å†Œåˆ°<code>Tunnel-Server</code>ä¸”åº”ç”¨éƒ¨ç½²äº†å¤šä¸ªå®ä¾‹ï¼Œæ¯æ¬¡æ‰§è¡Œç›‘å¬éœ€è¦å»å¤šä¸ªæœºå™¨ç›‘å¬çš„ç—›ç‚¹åœºæ™¯ã€‚</p>
<h2 id="æ’ä»¶ç‰¹æ€§">æ’ä»¶ç‰¹æ€§</h2>
<ol>
<li>åŸºäº <code>arthas idea plugin</code>ï¼Œä¸æ‰“æ–­åŸæ’ä»¶çš„ä½¿ç”¨æµç¨‹ï¼Œæ¶¦ç‰©ç»†æ— å£°ã€‚</li>
<li>åœ¨ <code>IDEA</code> å†…ç›´è¿ <code>Tunnel-Server</code>ï¼Œæ— éœ€æ‰“å¼€æµè§ˆå™¨ï¼Œä»£ç å¼‚å¸¸å¯å¿«é€Ÿå®šä½è¡Œå·ã€‚</li>
<li>åŒæ—¶è¿æ¥å•åº”ç”¨å¤šå®ä¾‹ï¼Œæ— éœ€æ‹·è´å‘½ä»¤åæ‰“å¼€å¤šä¸ªæµè§ˆå™¨çª—å£ç›‘å¬ã€‚</li>
</ol>
<h2 id="é…ç½®æ’ä»¶">é…ç½®æ’ä»¶</h2>
<h3 id="æ·»åŠ arthas-tunnel-serveråœ°å€">æ·»åŠ Arthas Tunnel-Serveråœ°å€</h3>
<p>ç‚¹å‡»AddæŒ‰é’®ï¼Œæ·»åŠ <code>Tunnel-Server</code>(æ’ä»¶ä¸æ ¡éªŒåœ°å€çš„æ­£ç¡®æ€§ï¼Œè¯·ä¿è¯å¡«å†™çš„åœ°å€å‡†ç¡®æ— è¯¯ï¼‰ã€‚</p>
<blockquote>
<ol>
<li>Nameï¼šå¯æ ¹æ®è‡ªå·±çš„æƒ…å†µå‘½å</li>
<li>TunnelAddressï¼šHTTPæœåŠ¡å™¨åœ°å€ï¼Œæ’ä»¶é€šè¿‡<code>Tunnel-Server</code>çš„Webç«¯å£è·å–ä¿¡æ¯ï¼Œæ ¹æ®æœåŠ¡å™¨éƒ¨ç½²å¡«å†™HTTP/HTTPSåè®®</li>
<li>WsAddressï¼šSocketæœåŠ¡å™¨åœ°å€ï¼Œæ’ä»¶å’Œ<code>Tunnel-Server Web</code>ç«¯åŸç†ä¸€è‡´ï¼Œä¼ªè£…æˆ<code>Socket</code>å®¢æˆ·ç«¯è·å–ä¿¡æ¯å’Œå‘é€æŒ‡ä»¤ï¼Œæ ¹æ®æœåŠ¡å™¨éƒ¨ç½²å¡«å†™WS/WSSåè®®</li>
</ol>
</blockquote>
<figure data-type="image" tabindex="1"><img src="https://imyzt.top/post-images/1728813373952.png" alt="" loading="lazy"></figure>
<h3 id="ä»åˆ—è¡¨ä¸­åˆ é™¤tunnel-server">ä»åˆ—è¡¨ä¸­åˆ é™¤Tunnel-Server</h3>
<blockquote>
<p>é€‰ä¸­å¾…åˆ é™¤çš„è¡Œï¼Œç‚¹å‡»åˆ é™¤å³å¯</p>
</blockquote>
<figure data-type="image" tabindex="2"><img src="https://imyzt.top/post-images/1728813400527.png" alt="" loading="lazy"></figure>
<h3 id="ç›´æ¥ä¿®æ”¹å•å…ƒæ ¼é…ç½®">ç›´æ¥ä¿®æ”¹å•å…ƒæ ¼é…ç½®</h3>
<blockquote>
<p>ç‚¹å‡»Applyæˆ–OKåç”Ÿæ•ˆ</p>
</blockquote>
<figure data-type="image" tabindex="3"><img src="https://imyzt.top/post-images/1728813427232.png" alt="" loading="lazy"></figure>
<h3 id="å‘½ä»¤çª—å£æ‰“å¼€é€‰æ‹©">å‘½ä»¤çª—å£æ‰“å¼€é€‰æ‹©</h3>
<blockquote>
<p>å¯é€‰æ‹©å¼¹å‡ºå‘½ä»¤å‘é€çª—å£ï¼Œå¦‚æœä¸å‹¾é€‰åˆ™æ­¤åŠŸèƒ½ä¸ä¼šå¯ç”¨ã€‚</p>
</blockquote>
<p><img src="https://imyzt.top/post-images/1728813447318.png" alt="" loading="lazy"><br>
<img src="https://imyzt.top/post-images/1728813466340.gif" alt="" loading="lazy"></p>
<h2 id="ä½¿ç”¨æ’ä»¶">ä½¿ç”¨æ’ä»¶</h2>
<h3 id="1-é€‰æ‹©å¾…ç›‘å¬çš„åº”ç”¨æ‰§è¡Œç›‘å¬">1. é€‰æ‹©å¾…ç›‘å¬çš„åº”ç”¨ï¼Œæ‰§è¡Œç›‘å¬</h3>
<blockquote>
<ol>
<li>é€‰æ‹© NameServer ç”¨ä»¥åˆ‡æ¢ç¯å¢ƒï¼ˆTunnel-Serverï¼‰</li>
<li>é€‰æ‹© App ç”¨ä»¥åˆ‡æ¢åº”ç”¨</li>
<li>é€‰æ‹© Agent ç”¨ä»¥åˆ‡æ¢å®ä¾‹ï¼ˆå¯é€‰all agentsæ¥ç›‘å¬æ‰€æœ‰å®ä¾‹ï¼‰<br>
ğŸ“¢ï¼šå½“App/Agentæœªå‡ºç°å¯é€‰é¡¹æ—¶ï¼Œè¯·æ£€æŸ¥é…ç½®çš„TunnelAddressåœ°å€æ˜¯å¦æ­£ç¡®ã€‚</li>
</ol>
</blockquote>
<figure data-type="image" tabindex="4"><img src="https://imyzt.top/post-images/1728813504156.gif" alt="" loading="lazy"></figure>
<h3 id="å·¥å…·æ ä»‹ç»">å·¥å…·æ ä»‹ç»</h3>
<h4 id="é‡å¯rerun">é‡å¯ï¼ˆRerunï¼‰</h4>
<blockquote>
<p>ç±»ä¼¼äº watchã€trace ç­‰æŒ‡ä»¤ï¼Œä¸€èˆ¬é€šè¿‡ -n æŒ‡å®šäº†æ‰§è¡Œå‡ æ¬¡ï¼Œå¦‚æœæ‰§è¡Œå®Œæ¯•ï¼Œå¯ä»¥é€šè¿‡æ­¤æŒ‰é’®é‡æ–°å¼€å§‹ä¸€æ¬¡ç›‘å¬ã€‚</p>
</blockquote>
<h4 id="è°ƒæ•´å‘½ä»¤modify">è°ƒæ•´å‘½ä»¤ï¼ˆModifyï¼‰</h4>
<blockquote>
<p>ç±»ä¼¼äº watchã€trace ç­‰æŒ‡ä»¤ï¼Œå‡å¦‚ä¸€å¼€å§‹ -x çš„æ·±åº¦ä¸å¤Ÿï¼Œéœ€è¦è°ƒæ•´æ—¶ä½¿ç”¨ï¼Œæˆ–ç›‘å¬æŸäº›å‚æ•°æ—¶ï¼Œéœ€è¦è°ƒæ•´SpELè¡¨è¾¾å¼æ—¶å¯ä»¥ä½¿ç”¨ã€‚<br>
ğŸ“¢ï¼šå¦‚éœ€è¦è°ƒæ•´ç›‘å¬çš„æ–¹æ³•æˆ–åˆ‡æ¢å…¶å®ƒæŒ‡ä»¤æ—¶ï¼Œå»ºè®®é‡æ–°å¼€å§‹è€Œéé€šè¿‡æ­¤æŒ‰é’®ï¼Œæ“ä½œä¼šæ›´é¡ºç•…ã€‚</p>
</blockquote>
<h4 id="åœæ­¢stop">åœæ­¢ï¼ˆStopï¼‰</h4>
<p>ç«‹å³åœæ­¢ç›‘å¬ï¼Œç±»ä¼¼äº Web UI ä¸Šé¢çš„ Ctrl+Cã€‚</p>
<h4 id="æ¸…ç©ºè¾“å‡ºé¢æ¿clear-all">æ¸…ç©ºè¾“å‡ºé¢æ¿ï¼ˆClear ALLï¼‰</h4>
<blockquote>
<p>æ¸…ç©ºè¾“å‡ºé¢æ¿ï¼Œä¸ä¼šåœæ­¢ç›‘å¬ã€‚</p>
</blockquote>
<h4 id="æ¼”ç¤º">æ¼”ç¤º</h4>
<figure data-type="image" tabindex="5"><img src="https://imyzt.top/post-images/1728813572945.gif" alt="" loading="lazy"></figure>
<h3 id="æ‰§è¡Œè‡ªå®šä¹‰æŒ‡ä»¤">æ‰§è¡Œè‡ªå®šä¹‰æŒ‡ä»¤</h3>
<h4 id="æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒæ•´å…¶ä»–æŒ‡ä»¤">æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒæ•´å…¶ä»–æŒ‡ä»¤</h4>
<blockquote>
<p>æ’ä»¶ä¿ç•™äº†ç”¨æˆ·è‡ªå®šä¹‰è¾“å…¥çš„å…¥å£ï¼Œå¯ä»¥ç”¨äºæ‹·è´ Get All Available Commandå¤„æ‹·è´çš„æŒ‡ä»¤ã€‚<br>
é€šè¿‡é”®ç›˜ â†‘ â†“é”®ï¼Œå¯ä»¥å¿«é€Ÿåˆ‡æ¢å†å²å·²æ‰§è¡Œçš„æŒ‡ä»¤ã€‚<br>
å›è½¦æˆ–ç‚¹å‡»æŒ‰é’® Exec å¯æ‰§è¡ŒæŒ‡ä»¤ã€‚<br>
<img src="https://imyzt.top/post-images/1728813603660.gif" alt="" loading="lazy"></p>
</blockquote>
<h4 id="ç›´æ¥æ‰§è¡Œè‡ªå®šä¹‰æŒ‡ä»¤">ç›´æ¥æ‰§è¡Œè‡ªå®šä¹‰æŒ‡ä»¤</h4>
<blockquote>
<p>ä¸ºæ–¹ä¾¿ç›´æ¥æ‹·è´æŒ‡ä»¤å‘é€è‡³å¤šä¸ªå®ä¾‹æ‰§è¡Œï¼Œåœ¨å³é”®èœå•æ³¨å†Œäº† OpenArthasTerminal ç”¨äºæ‰“å¼€ä¸€ä¸ªç©ºç™½çš„å¯¹è¯çª—å£ã€‚</p>
</blockquote>
<p><img src="https://imyzt.top/post-images/1728813642897.png" alt="" loading="lazy"><br>
<img src="https://imyzt.top/post-images/1728813647297.png" alt="" loading="lazy"></p>
<h3 id="å¼‚å¸¸å®šä½è¡Œå·">å¼‚å¸¸å®šä½è¡Œå·</h3>
<figure data-type="image" tabindex="6"><img src="https://imyzt.top/post-images/1728813654738.png" alt="" loading="lazy"></figure>
<h2 id="éƒ¨ç½²tunnel-server">éƒ¨ç½²Tunnel-Server</h2>
<p>åœ¨å¤§éƒ¨åˆ†å•æœºçš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½ç›´æ¥åœ¨æœºå™¨ä¸Šè¿è¡Œ java -jar arthas-boot.jar æ¥è¿è¡Œä¸€ä¸ªå•æœºç‰ˆçš„ Arthas æ¥ç›‘å¬åº”ç”¨ï¼Œä½†åœ¨å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œä¸€ä¸ªæœåŠ¡å¯èƒ½éƒ¨ç½²äº†å¤šä¸ªå®ä¾‹ï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œå†ç™»å½•åˆ°æœºå™¨ä¸ŠæŒ¨ä¸ªè¿è¡Œå•æœºç‰ˆå°±è¾ƒä¸ºä¸ä¾¿äº†ã€‚<br>
å®˜æ–¹ä¹Ÿè€ƒè™‘åˆ°äº†è¿™ç§æƒ…å†µï¼Œæ‰€ä»¥ä¹Ÿæä¾›äº†å¯¹åº”çš„è§£å†³æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯ Arthas Tunnel-Serverï¼Œä¸‹æ–‡æ‘˜è‡ªå®˜ç½‘ï¼š</p>
<blockquote>
<p>é€šè¿‡ Arthas Tunnel Server/Client æ¥è¿œç¨‹ç®¡ç†/è¿æ¥å¤šä¸ª Agentã€‚<br>
æ¯”å¦‚ï¼Œåœ¨æµå¼è®¡ç®—é‡Œï¼ŒJava è¿›ç¨‹å¯ä»¥æ˜¯åœ¨ä¸åŒçš„æœºå™¨å¯åŠ¨çš„ï¼Œæƒ³è¦ä½¿ç”¨ Arthas å»è¯Šæ–­ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºç”¨æˆ·é€šå¸¸æ²¡æœ‰æœºå™¨çš„æƒé™ï¼Œå³ä½¿ç™»é™†æœºå™¨ä¹Ÿåˆ†ä¸æ¸…æ˜¯å“ªä¸ª Java è¿›ç¨‹ã€‚<br>
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ Arthas Tunnel Server/Clientã€‚<br>
å‚è€ƒ:<br>
â— 1: Web Console<br>
â— 2: Arthas Spring Boot Starter</p>
</blockquote>
<h3 id="ä¸‹è½½å¹¶éƒ¨ç½²-tunnel-server">ä¸‹è½½å¹¶éƒ¨ç½² Tunnel-Server</h3>
<p>ä¸‹è½½Tunnel-Serverï¼ˆhttps://github.com/alibaba/arthas/releasesï¼‰ï¼Œå› ä¸ºServeræœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ª jar åŒ…ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥é€šè¿‡å‘½ä»¤å¯åŠ¨ã€‚<br>
å…·ä½“ç»†èŠ‚è§å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://arthas.aliyun.com/doc/tunnel.html#tunnel-server-%E7%9A%84%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2">arthas å®˜ç½‘</a></p>
<pre><code class="language-shell">java -Darthas.enable-detail-pages=true -jar ~/.arthas/arthas-tunnel-server.jar
</code></pre>
<figure data-type="image" tabindex="7"><img src="https://imyzt.top/post-images/1728813731283.png" alt="" loading="lazy"></figure>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒArthas Tunnel-Server çš„ web ç«¯å£æ˜¯8080ï¼Œarthas agentè¿æ¥çš„ç«¯å£æ˜¯7777ã€‚</p>
<h3 id="å¯åŠ¨åº”ç”¨å¹¶è¿æ¥è‡³tunnel-server">å¯åŠ¨åº”ç”¨å¹¶è¿æ¥è‡³Tunnel-Server</h3>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ <code> java -jar arthas-boot.jar</code> å¯åŠ¨ä¸€ä¸ª <code>Arthas</code> åº”ç”¨æ¥ç›‘å¬æœ¬æœºçš„ <code>Java</code> åº”ç”¨ã€‚ä½†å¦‚æœæˆ‘ä»¬æ˜¯ä½¿ç”¨ <code>SpringBoot</code> æ¥æ„å»ºåº”ç”¨ï¼Œé‚£ä¹ˆæ›´æ¨èä½¿ç”¨ <code>Arthas Spring Boot Starter</code>ï¼ˆåªæ”¯æŒSpringBoot2.+ï¼‰ ï¼Œåº”ç”¨å¯åŠ¨åï¼Œ<code>Spring</code> ä¼šå¯åŠ¨ <code>Arthas</code>ï¼Œå¹¶ä¸” <code>Arrach</code> è‡ªèº«çš„è¿›ç¨‹ã€‚</p>
<h4 id="jar-jar-è¿æ¥-tunnel-server">jar -jar è¿æ¥ tunnel-server</h4>
<pre><code class="language-shell">java -jar arthas-boot.jar --tunnel-server 'ws://127.0.0.1:7777/ws'
</code></pre>
<h4 id="springboot-starter-è¿æ¥-tunnel-server">SpringBoot Starter è¿æ¥ tunnel-server</h4>
<ol>
<li>åˆ›å»ºä¸€ä¸ªSpringBootçš„Demoåº”ç”¨ã€‚</li>
<li>å¼•å…¥ Starter çš„ä¾èµ–ï¼ˆå½“å‰æœ€æ–°ç‰ˆæœ¬ 4.0.0ï¼‰ã€‚</li>
</ol>
<pre><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.taobao.arthas&lt;/groupId&gt;
  &lt;artifactId&gt;arthas-spring-boot-starter&lt;/artifactId&gt;
  &lt;version&gt;4.0.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<ol start="3">
<li>å†åœ¨ application.properties æ–‡ä»¶ä¸­æŒ‡å®šå‡ ä¸ªå‚æ•°ã€‚</li>
</ol>
<pre><code class="language-properties">arthas.http-port=0
arthas.telnet-port=0
arthas.app-name=${spring.application.name}-${spring.profiles.active}
arthas.tunnel-server=ws://127.0.0.1:7777/ws
</code></pre>
<ol start="4">
<li>å¯åŠ¨åº”ç”¨ï¼Œå‘ç°æ—¥å¿—ä¸­æœ‰å¦‚ä¸‹å‚æ•°å°±è¯´æ˜é…ç½®å®Œæˆã€‚</li>
</ol>
<pre><code class="language-log">2024-09-21T23:11:48.536+08:00  INFO 90583 --- [arthas-terminal-demo] [           main] c.a.arthas.spring.ArthasConfiguration    : Arthas agent start success.
</code></pre>
<h3 id="tunnel-serverçš„ç®¡ç†é¡µé¢">Tunnel-Serverçš„ç®¡ç†é¡µé¢</h3>
<p>å®Œæˆä¸Šé¢çš„ä¸¤ä¸ªæ­¥éª¤ä¹‹åï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:8080/apps.htmlï¼Œå°±å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„å†…å®¹äº†ï¼Œæœ€ç»ˆå®ç°åœ¨æµè§ˆå™¨ä¸­ç›‘å¬åº”ç”¨ã€‚<br>
<img src="https://imyzt.top/post-images/1728813863049.png" alt="" loading="lazy"><br>
<img src="https://imyzt.top/post-images/1728813866629.png" alt="" loading="lazy"><br>
<img src="https://imyzt.top/post-images/1728813870329.png" alt="" loading="lazy"></p>
<h3 id="å»ºè®®">å»ºè®®</h3>
<ol>
<li>Tunnel-Server å…·å¤‡è¾ƒé«˜æƒé™ï¼Œå®˜æ–¹ä¸å»ºè®®éƒ¨ç½²åˆ°å…¬ç½‘å¯è®¿é—®çš„åœ°å€ä¸Šã€‚</li>
<li>Tunnel-Server ä¸ºå†…éƒ¨è¯Šæ–­å·¥å…·ï¼Œæ²¡æœ‰å¼€å‘å¯¹åº”çš„æƒé™æ§åˆ¶èƒ½åŠ›ï¼Œéœ€æ³¨æ„é£é™©ã€‚</li>
</ol>
<h2 id="å·¥ä½œåŸç†">å·¥ä½œåŸç†</h2>
<p>æ’ä»¶ä¸»è¦é€šè¿‡Tunnel-Server Web UIæ‰€ä½¿ç”¨çš„æ¥å£ï¼Œå°†å…¶åˆ©ç”¨èµ·æ¥åœ¨IDEAä¸­ä½¿ç”¨ï¼Œä»…ä½¿ç”¨å…¶ä¸‰ä¸ªæ¥å£ï¼š</p>
<ul>
<li><code>/api/tunnelApps</code> è·å–æ‰€æœ‰App</li>
<li><code>/api/tunnelAgentInfo?app=</code> è·å–Appçš„æ‰€æœ‰Agent</li>
<li><code>ws?method=connectArthas&amp;id=&amp;targetServer=</code> é€šè¿‡WSè¿æ¥tunnel-serverå®æ—¶é€šä¿¡</li>
</ul>
<p>æ•´ä½“çš„äº¤äº’æµç¨‹å¦‚ä¸‹åºåˆ—å›¾ï¼š<br>
<img src="https://imyzt.top/post-images/1728813920966.png" alt="" loading="lazy"></p>
<p>å…¶å®ƒ<br>
ç›®å‰ä»…æ”¯æŒéƒ¨åˆ†å¸¸ç”¨èœå•ï¼Œå…¶å®ƒèœå•åœ¨ IDEA å†…å‘ˆç°ä¸å¤Ÿä¼˜é›…æˆ–æ— æ³•æ»¡è¶³ï¼Œæ•…æœªåšæ”¯æŒã€‚<br>
æ”¯æŒçš„èœå•åˆ—è¡¨ï¼š</p>
<ul>
<li>watch</li>
<li>trace</li>
<li>stack</li>
<li>sc</li>
<li>sm</li>
<li>getstatic</li>
<li>jad</li>
<li>thread</li>
<li>monitor</li>
<li>vmoption<br>
å¯¹äºä¸æ”¯æŒçš„èœå•ï¼Œå…¶ä¸­éƒ¨åˆ†ä¹Ÿå¯ä»¥é€šè¿‡ã€æ‰§è¡Œè‡ªå®šä¹‰æŒ‡ä»¤ã€‘è‡ªè¡Œæ‹·è´æ‰§è¡Œï¼Œå½“ç„¶ï¼Œåç»­ä¹Ÿå¯ä»¥è€ƒè™‘è¡¥å……éƒ¨åˆ†èœå•ã€‚</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[False-Sharing]]></title>
        <id>https://imyzt.top/post/false-sharing/</id>
        <link href="https://imyzt.top/post/false-sharing/">
        </link>
        <updated>2024-08-21T14:41:24.000Z</updated>
        <content type="html"><![CDATA[<p>åœ¨é˜…è¯»VIVOçš„åšå®¢<a href="https://mp.weixin.qq.com/s/YKZ1n5O30nowOrfmjMcmOw">é«˜æ€§èƒ½æ— é”é˜Ÿåˆ— Disruptor æ ¸å¿ƒåŸç†åˆ†æåŠå…¶åœ¨iä¸»é¢˜ä¸šåŠ¡ä¸­çš„åº”ç”¨</a>çš„æ—¶å€™ï¼Œäº†è§£åˆ° <code>Disruptor</code> é«˜æ€§èƒ½çš„æ ¸å¿ƒåŸå› ï¼š</p>
<ol>
<li>ç©ºé—´é¢„åˆ†é…</li>
<li>é¿å…ä¼ªå…±äº«</li>
<li>æ— é”</li>
</ol>
<p>å…¶ä¸­ <strong>ä¼ªå…±äº«</strong> çš„æ¦‚å¿µä¹‹å‰æ²¡æœ‰äº†è§£è¿‡ï¼Œæ•…ç‰¹åœ°äº†è§£å­¦ä¹ äº†ä¸‹ï¼Œä¸»è¦æ¶‰åŠåˆ°ä¸€äº›åŸºç¡€çš„æ¦‚å¿µï¼š</p>
<ol>
<li>CPUçš„åˆ†çº§ç¼“å­˜æœºåˆ¶</li>
<li>volatileçš„å†…å­˜å¯è§æ€§</li>
<li>Java longç±»å‹/Longç±»å‹çš„å­—èŠ‚å¤§å°</li>
</ol>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒCPUåœ¨è¯»å–å†…å­˜ä¸­çš„æ•°æ®æ—¶ï¼Œå¹¶ä¸æ˜¯è¯»å–çš„ç›´æ¥å†…å­˜ï¼Œè€Œæ˜¯ä»L1/L2/L3ç¼“å­˜ä¸­è¯»å–æ•°æ®ï¼Œè€Œè¯»å–ç¼“å­˜ä¹Ÿå¹¶éæŒ‰<code>1å­—èŠ‚</code>çš„è¯»å–ï¼Œè€Œæ˜¯æŒ‰ç…§<code>ç¼“å­˜è¡Œ</code>(é€šå¸¸64å­—èŠ‚)ä¸€å—ä¸€å—çš„è¯»å–ï¼Œä»¥æ­¤æ¥æé«˜è¯»å–æ•ˆç‡ã€‚</p>
<p>å‘¨æ‰€ä¹Ÿå‘¨çŸ¥ï¼Œç°ä»£è®¡ç®—æœºéƒ½æ˜¯å¤šæ ¸CPUåœ¨è¿è¡Œï¼Œçº¿ç¨‹éƒ½ä¼šè¢«åˆ†é…CPUæ¥æ‰§è¡Œï¼Œæ‰€ä»¥çº¿ç¨‹å†…çš„å˜é‡æ•°æ®æ˜¯éœ€è¦è¯»å–åˆ°CPU Cacheä¸­æ‰èƒ½å¤Ÿå¯¹CPUå¯è§çš„ï¼Œä¸ºäº†è§£å†³å†…å­˜åœ¨CPU1ä¸­ä¿®æ”¹åCPU2ä¸å¯è§ï¼ˆè„è¯»ï¼‰çš„é—®é¢˜ï¼Œåœ¨Javaä¸­æœ‰è®¾è®¡å˜é‡ä¿®é¥°ç¬¦<code>volatile</code>æ¥ä¿®é¥°å˜é‡ï¼Œä»¥æ­¤æ¥å®ç°æ•°æ®åœ¨å¤šä¸ªCPUä¹‹é—´ä¸ä¼šäº§ç”Ÿè„è¯»é—®é¢˜ï¼Œå†…å­˜åœ¨ä»»ä½•ä¸€ä¸ªCPUä¸Šå‘ç”Ÿä¿®æ”¹åï¼Œåœ¨å…¶ä»–CPUä¸Šå‡ä¸å¯ç”¨è€Œä¸¢å¼ƒé‡æ–°ä»å†…å­˜ä¸­è·å–ã€‚</p>
<p>å½“ç„¶ï¼Œä¹Ÿæ­£æ˜¯å› ä¸ºä»¥ä¸Šè®¾è®¡ï¼Œå¸¦æ¥äº†ä¸€äº›é¢„æœŸå¤–çš„ç»“æœï¼ˆä¸æ˜¯é—®é¢˜æˆ–bugï¼‰ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<p>å¯¹äºä¸‹é¢çš„ä»£ç ï¼š</p>
<pre><code class="language-java">public class FalseSharing {
    public static void main(String[] args) throws InterruptedException {
        int num = 100000000;
        Pointer pointer1 = new Pointer();
        long start = System.currentTimeMillis();
        Thread t1 = new Thread(() -&gt; {
            for(int i = 0; i &lt; num; i++){
                pointer1.x++;
            }
        });
        Thread t2 = new Thread(() -&gt; {
            for(int i = 0; i &lt; num; i++){
                pointer1.y++;
            }
        });
        t1.start();
        t2.start();
        t1.join();
        t2.join();
        System.out.println(&quot;pointer1=&quot; + (System.currentTimeMillis() - start));
    }
}

class Pointer {
    volatile long x;
    volatile long y;
}
</code></pre>
<p>ä¸Šè¿°ä»£ç åœ¨æˆ‘çš„ç”µè„‘ä¸Šæ‰§è¡Œï¼Œ<code>éœ€è¦3.5ç§’+</code>ï¼Œå¤šæ¬¡æ‰§è¡Œäº¦ç„¶å¦‚æ­¤ï¼Œè€Œæˆ‘ä»¬åªéœ€ç¨ä½œè°ƒæ•´ï¼Œæ”¹æˆå¦‚ä¸‹ä»£ç ï¼Œåˆ™åªéœ€è¦<code>0.5ç§’å·¦å³</code>å³å¯æ‰§è¡Œå®Œæ¯•ï¼Œè¿™æ˜¯ä¸ºä½•ï¼Ÿ</p>
<pre><code class="language-java">public class FalseSharing {

    public static void main(String[] args) throws InterruptedException {
        int num = 100000000;
        Pointer2 pointer2 = new Pointer2();
        long start2 = System.currentTimeMillis();
        Thread t3 = new Thread(() -&gt; {
            for(int i = 0; i &lt; num; i++){
                pointer2.x++;
            }
        });
        Thread t4 = new Thread(() -&gt; {
            for(int i = 0; i &lt; num; i++){
                pointer2.y++;
            }
        });
        t3.start();
        t4.start();
        t3.join();
        t4.join();
        System.out.println(&quot;pointer2=&quot; + (System.currentTimeMillis() - start2));
    }
}

class Pointer2 {
    volatile long x;
    // long p1, p2, p3, p4, p5, p6, p7;
    Long z1, z2; long z3;
    volatile long y;
}
</code></pre>
<p>ä»¥ä¸Šç°è±¡å¯¹åº”çš„æœºåˆ¶ï¼Œæ­£æ˜¯å› ä¸ºç¼“å­˜è¡Œçš„è®¾è®¡ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒåŒ…å«äº†çº¿ç¨‹t1/t2ï¼ˆt3å’Œt4ç­‰åŒï¼‰ä¸¤ç»„çº¿ç¨‹ï¼Œåˆ†åˆ«å¯¹xå’Œyè¿›è¡Œç´¯åŠ æ“ä½œï¼Œçœ‹ä¼¼æ˜¯ä¸¤ä¸ªçº¿ç¨‹ï¼ˆCPUåœ¨åˆ†åˆ«å¯¹ä¸¤å—å†…å­˜ä¸­çš„å˜é‡æ‰§è¡Œç´¯åŠ ï¼‰ï¼Œä½†æ˜¯å› ä¸ºCPUæ˜¯ä»¥ç¼“å­˜è¡Œçš„æ–¹å¼è¯»å–å†…å­˜ï¼Œ<code>Pointer1</code>ä¸­çš„xå’Œyåœ¨å†…å­˜ä¸­æ—¶ç›¸é‚»çš„ä¸¤å—å†…å­˜ï¼ŒJavaçš„åŸºæœ¬æ•°æ®ç±»å‹<code>longç±»å‹ï¼Œå ç”¨8å­—èŠ‚</code>ï¼Œæ‰€ä»¥xå’Œy(åŠ èµ·æ¥16å­—èŠ‚)è¢«æ”¾åˆ°åŒä¸€ä¸ªç¼“å­˜è¡Œäº†ï¼Œå½“CPU1å¯¹xåšäº†ä¿®æ”¹åï¼ŒCPU2è¯»å–åˆ°yæ—¶å‘ç°ï¼Œå¯¹åº”<strong>ç¼“å­˜è¡Œå·²ç»å¤±æ•ˆ</strong>äº†ï¼Œæ‰€ä»¥ä¸å¾—ä¸é‡æ–°ä»å†…å­˜ä¸­é‡æ–°è¯»å–æ•°æ®ï¼Œä»è€Œå¯¼è‡´äº†æ•ˆç‡é™ä½ã€‚</p>
<p>è€Œæˆ‘ä»¬ä¸‹é¢ç»™å‡ºçš„ä»£ç ï¼Œ<code>Pointer2</code>çš„xå’Œyå˜é‡é—´ï¼Œè¢«å¡äº†ä¸¤ç»„å˜é‡ï¼š</p>
<ol>
<li>long p1, p2, p3, p4, p5, p6, p7; --longç±»å‹,å ç”¨8ä¸ªå­—èŠ‚, 8*7=56</li>
<li>Long z1, z2; long z3; --åŒ…è£…Longç±»å‹,æ ¹æ®è®¡ç®—æœºä¸åŒæœ‰æ‰€ä¸åŒ,åœ¨æˆ‘ç”µè„‘ä¸Šå ç”¨24å­—èŠ‚, 24+24+8=56<br>
ä¸¤ç»„å˜é‡ä»»ä½•ä¸€ç»„éƒ½å¯ä»¥è§£å†³ä¼ªå…±äº«çš„é—®é¢˜ï¼Œä¹‹æ‰€ä»¥å¡ä¸¤ç»„å˜é‡ï¼Œéƒ½æ˜¯ä¸ºäº†éªŒè¯ç¼“å­˜è¡Œçš„å­˜åœ¨å’Œè§£å†³æ–¹æ¡ˆã€‚</li>
</ol>
<p>æ–¹æ¡ˆä¸€ç›´æ¥ä½¿ç”¨<code>7ä¸ªåŸºæœ¬æ•°æ®ç±»å‹</code>ï¼Œå ç”¨äº†56ä¸ªå­—èŠ‚ï¼ŒåŠ ä¸Šxå˜é‡è‡ªèº«ï¼Œåˆšå¥½å ç”¨ä¸€ä¸ªå®Œæ•´çš„ç¼“å­˜è¡Œ64å­—èŠ‚ï¼Œyåªèƒ½åœ¨å¦ä¸€ä¸ªç¼“å­˜è¡Œäº†ã€‚<br>
æ–¹æ¡ˆäºŒä½¿ç”¨äº†<code>2ç»„åŒ…è£…æ•°æ®ç±»å‹ï¼Œ1ç»„åŸºæœ¬æ•°æ®ç±»å‹</code>ï¼ŒåŠ èµ·æ¥ä¾æ—§å ç”¨çš„æ˜¯56ä¸ªå­—èŠ‚ï¼Œä¾æ—§èƒ½å°†ä¸€ä¸ªç¼“å­˜è¡Œå æ»¡ï¼Œè§£å†³ç¼“å­˜è¡Œå¤±æ•ˆé—®é¢˜ã€‚</p>
<p>é€šè¿‡å¯¹è¿™å—çš„å­¦ä¹ ï¼Œå¯¹åŸºç¡€çŸ¥è¯†åˆåšäº†ä¸€ä¸ªå·©å›ºï¼Œé€ ç«ç®­çš„çŸ¥è¯†åˆå¢åŠ äº†ã€‚ğŸ¤¡</p>
<p>åšæ–‡å‚è€ƒï¼š</p>
<ol>
<li>ç¾å›¢ï¼š<a href="https://tech.meituan.com/2016/11/18/disruptor.html">é«˜æ€§èƒ½é˜Ÿåˆ—â€”â€”Disruptor</a></li>
<li>VIVOï¼š<a href="https://mp.weixin.qq.com/s/YKZ1n5O30nowOrfmjMcmOw">é«˜æ€§èƒ½æ— é”é˜Ÿåˆ— Disruptor æ ¸å¿ƒåŸç†åˆ†æåŠå…¶åœ¨iä¸»é¢˜ä¸šåŠ¡ä¸­çš„åº”ç”¨</a></li>
</ol>
<p>å®æ“ä»£ç ï¼š<a href="https://github.com/imyzt/learning-technology-code/blob/master/framework-in-java/disruptor-demo/src/main/java/top/imyzt/learning/disruptor/FalseSharing.java">FalseSharing</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Spring Eventsä½¿ç”¨å’Œé—®é¢˜åˆ†æ]]></title>
        <id>https://imyzt.top/post/spring-events-shi-yong-xiang-jie/</id>
        <link href="https://imyzt.top/post/spring-events-shi-yong-xiang-jie/">
        </link>
        <updated>2024-08-04T08:16:39.000Z</updated>
        <content type="html"><![CDATA[<p>æ­¤ç¯‡æ–‡ç« ä¸»è¦ç”¨äºè®²è§£ä½¿ç”¨Springè¿›è¡Œç¼–ç æ—¶ï¼Œæ ¸å¿ƒä¸éæ ¸å¿ƒä»£ç è§£è€¦åˆå¸¸ç”¨çš„è§‚å¯Ÿè€…æ¨¡å¼<code>@EventListener</code>çš„ä½¿ç”¨æ–¹æ³•ï¼Œä»¥åŠä¸å¸¸ç”¨çš„<code>@TransactionalEventListener</code>çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚</p>
<h1 id="å¸¸è§„æƒ…å†µ">å¸¸è§„æƒ…å†µ</h1>
<p>åœ¨æˆ‘ä»¬å¸¸è§„çš„ä¸šåŠ¡å¼€å‘ä¸­ï¼Œæœ‰å¾ˆå¤šåœºæ™¯éƒ½ä¼šä½¿ç”¨åˆ°è§‚å¯Ÿè€…æ¨¡å¼æ¥è§£è€¦åˆï¼Œå°†éæ ¸å¿ƒæµç¨‹å‰¥ç¦»åˆ°ä¸»æµç¨‹ä¹‹å¤–ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§ï¼Œä¸¾ä¾‹ï¼šç”¨æˆ·æ³¨å†Œæµç¨‹ï¼Œå½“ç”¨æˆ·æ³¨å†Œå®Œæˆä¹‹åï¼Œéœ€è¦ç»™ç”¨æˆ·å‘é€ä¸€ä¸ªæ³¨å†ŒæˆåŠŸçš„çŸ­ä¿¡é€šçŸ¥ï¼Œæ ¸å¿ƒæµç¨‹æ˜¯å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œæ¬¡è¦æµç¨‹æ˜¯å‘é€çŸ­ä¿¡é€šçŸ¥ã€‚<br>
<img src="https://imyzt.top/post-images/1722759866465.png" alt="" loading="lazy"></p>
<p>ç”±äºæœ¬æ–‡ä¸»è¦æ˜¯ç”¨æ¥ä»‹ç»SpringEventçš„ä½¿ç”¨ï¼Œæ‰€ä»¥å¦å¤–çš„æ–¹æ¡ˆå°±ä¸åšä»‹ç»äº†ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®æ¥æ¨¡æ‹Ÿè¿™éƒ¨åˆ†ä¸šåŠ¡ä»£ç çš„å®ç°ï¼š</p>
<p>å¯¹äºè¿™æ ·ä¸€ä¸ªæµç¨‹ï¼Œæˆ‘ä»¬å¸¸è§„çš„è®¾è®¡æ–¹æ¡ˆæœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ol>
<li>è®¾è®¡ä¸€ä¸ªæœ‰ç•Œé˜Ÿåˆ—çº¿ç¨‹æ± ï¼Œå°†å‘é€çŸ­ä¿¡æµç¨‹æäº¤ç»™å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œã€‚</li>
<li>ä½¿ç”¨SpringEventï¼Œå‘å¸ƒç”¨æˆ·æ³¨å†ŒæˆåŠŸäº‹ä»¶ï¼Œç”±ç›‘å¬å™¨æ‰§è¡Œï¼ˆä¹Ÿå¯ä»¥é€‰æ‹©æ‰§è¡Œçº¿ç¨‹ï¼‰ã€‚</li>
<li>ä½¿ç”¨MQï¼Œç”±æ¶ˆè´¹è€…è´Ÿè´£æ‰§è¡Œã€‚ï¼ˆæœ€é‡ï¼Œæœ€ç¨³å¦¥çš„æ–¹æ¡ˆï¼‰</li>
</ol>
<h3 id="entity">Entity</h3>
<pre><code class="language-java">public class User {
    @TableId(type = IdType.ASSIGN_ID)
    private String id;
    private String username;
    private String address;
}
</code></pre>
<h3 id="service">Service</h3>
<pre><code class="language-java">public interface UserService extends IService&lt;User&gt; {
    String addUser(String username, String address);
}

public class UserServiceImpl extends ServiceImpl&lt;UserMapper, User&gt; implements UserService {

    private final ApplicationContext applicationContext;
    @Override
    @Transactional(rollbackFor = Exception.class)
    public String addUser(String username, String address) {
        User user = User.builder().username(username).address(address).build();
        log.info(&quot;æ·»åŠ ç”¨æˆ·å¼€å§‹&quot;);
        super.save(user);
        log.info(&quot;æ·»åŠ ç”¨æˆ·æˆåŠŸ, å‘é€äº‹ä»¶å¼€å§‹&quot;);
        applicationContext.publishEvent(new AddUserEvent(this, user));
        log.info(&quot;æ·»åŠ ç”¨æˆ·æˆåŠŸ, å‘é€äº‹ä»¶ç»“æŸ&quot;);
        return user.getId();
    }
}
</code></pre>
<h3 id="listener">Listener</h3>
<pre><code class="language-java">public class UserListener {
    @EventListener(AddUserEvent.class)
    public void addHandler(AddUserEvent event) {
        User user = event.getUser();
        log.info(&quot;æ¥æ”¶åˆ°æ·»åŠ ç”¨æˆ·äº‹ä»¶, å‘é€çŸ­ä¿¡å®Œæˆ Normal, user={}&quot;, user.toString());
    }
}
</code></pre>
<h3 id="controller">Controller</h3>
<pre><code class="language-java">@RequestMapping(&quot;user&quot;)
public class UserController {
    private final UserService userService;
    @PostMapping(&quot;/add&quot;)
    public String add(String username, String address) {
        return userService.addUser(username, address);
    }
}
</code></pre>
<h3 id="db">DB</h3>
<p>ORMæ¡†æ¶æˆ‘ä»¬ä½¿ç”¨Mybatis-Plusï¼Œæ•°æ®åº“æˆ‘ä»¬ä½¿ç”¨db2ä½œä¸ºä¸´æ—¶æ•°æ®åº“ï¼Œç›®å‰æ²¡æœ‰æ•°æ®ã€‚<br>
<img src="https://imyzt.top/post-images/1722760277166.png" alt="" loading="lazy"></p>
<pre><code class="language-shell">2024-08-04 16:31:45.590  INFO 55648 --- [nio-8080-exec-4] t.i.l.s.d.service.impl.UserServiceImpl   : æ·»åŠ ç”¨æˆ·å¼€å§‹
Creating a new SqlSession
Registering transaction synchronization for SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6e3d4aa9]
JDBC Connection [HikariProxyConnection@1603671607 wrapping conn0: url=jdbc:h2:~/mydb user=ROOT] will be managed by Spring
==&gt;  Preparing: INSERT INTO user ( id, username, address ) VALUES ( ?, ?, ? )
==&gt; Parameters: 1820014751548219393(String), yzt(String), shenzhen(String)
&lt;==    Updates: 1
Releasing transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6e3d4aa9]
2024-08-04 16:31:45.705  INFO 55648 --- [nio-8080-exec-4] t.i.l.s.d.service.impl.UserServiceImpl   : æ·»åŠ ç”¨æˆ·æˆåŠŸ, å‘é€äº‹ä»¶å¼€å§‹
2024-08-04 16:31:45.708  INFO 55648 --- [nio-8080-exec-4] t.i.l.s.demos.listener.UserListener      : æ¥æ”¶åˆ°æ·»åŠ ç”¨æˆ·äº‹ä»¶, å‘é€çŸ­ä¿¡å®Œæˆ Normal, user=User(id=1820014751548219393, username=yzt, address=shenzhen)
2024-08-04 16:31:45.709  INFO 55648 --- [nio-8080-exec-4] t.i.l.s.d.service.impl.UserServiceImpl   : æ·»åŠ ç”¨æˆ·æˆåŠŸ, å‘é€äº‹ä»¶ç»“æŸ
Transaction synchronization committing SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6e3d4aa9]
Transaction synchronization deregistering SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6e3d4aa9]
Transaction synchronization closing SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@6e3d4aa9]
</code></pre>
<h3 id="å†æ¬¡æŸ¥çœ‹æ•°æ®">å†æ¬¡æŸ¥çœ‹æ•°æ®</h3>
<p>select * from user;</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>USERNAME</th>
<th>ADDRESS</th>
</tr>
</thead>
<tbody>
<tr>
<td>1820014751548219393</td>
<td>yzt</td>
<td>shenzhen</td>
</tr>
</tbody>
</table>
<p>(1 row, 2 ms)</p>
<h3 id="å°ç»“">å°ç»“</h3>
<p>ä¸ºäº†æ›´å¥½çš„å‘ˆç°æ‰§è¡Œè¿‡ç¨‹ï¼Œä¸Šé¢çš„ä»£ç æ²¡æœ‰æ·»åŠ å¼‚æ­¥ï¼Œé€šè¿‡ä¸Šé¢çš„ä»£ç æ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°æ•´ä¸ªè¿‡ç¨‹å¤§æ¦‚å¦‚ä¸‹å›¾æ‰€ç¤º<br>
<img src="https://imyzt.top/post-images/1722760898291.png" alt="" loading="lazy"></p>
<p>ä¸€èˆ¬æˆ‘ä»¬çš„ä¸šåŠ¡ç¼–ç éƒ½æ˜¯ä½¿ç”¨<code>@EventListener</code>æ¥å®ç°ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ã€‚ä½†æ˜¯åœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°é¢„æœŸä¹‹å¤–çš„ç»“æœã€‚</p>
<h1 id="åœºæ™¯2äº‹åŠ¡å¼‚å¸¸">åœºæ™¯2ï¼Œäº‹åŠ¡å¼‚å¸¸</h1>
<p>ä¸Šé¢æˆ‘ä»¬æ¼”ç¤ºçš„æ›´å¤šæ˜¯ä¸šåŠ¡æ­£å¸¸çš„æƒ…å†µï¼Œä½†é€šå¸¸æƒ…å†µä¸‹ï¼Œæ·»åŠ ç”¨æˆ·ä¸ä»…ä»…åªæœ‰è¿™ä¹ˆç®€å•çš„ä¸šåŠ¡ï¼Œåœ¨å­˜å‚¨ä¹‹åï¼Œå¯èƒ½è¿˜æœ‰å…¶ä»–çš„ä¸šåŠ¡ï¼Œæ¯”å¦‚ä¸ºé‚€è¯·äººç»“ç®—å¥–åŠ±ä¹‹ç±»ï¼ˆä¸¾ä¾‹ï¼‰ï¼Œé‚£ä¹ˆæµç¨‹é•¿äº†ä¹‹åæ€»ä¼šæœ‰å¼‚å¸¸çš„å¯èƒ½ï¼Œæ¯”å¦‚æˆ‘ä»¬ç”¨<code>address=shanghai</code>æ¥æ¨¡æ‹Ÿä¸šåŠ¡å¼‚å¸¸ï¼š</p>
<pre><code class="language-java">public class UserServiceImpl extends ServiceImpl&lt;UserMapper, User&gt; implements UserService {
    private final ApplicationContext applicationContext;
    @Override
    @Transactional(rollbackFor = Exception.class)
    public String addUser(String username, String address) {
        User user = User.builder().username(username).address(address).build();
        log.info(&quot;æ·»åŠ ç”¨æˆ·å¼€å§‹&quot;);
        super.save(user);
        log.info(&quot;æ·»åŠ ç”¨æˆ·æˆåŠŸ, å‘é€äº‹ä»¶å¼€å§‹&quot;);
        applicationContext.publishEvent(new AddUserEvent(this, user));
        log.info(&quot;æ·»åŠ ç”¨æˆ·æˆåŠŸ, å‘é€äº‹ä»¶ç»“æŸ&quot;);
        
        // æ¨¡æ‹Ÿå¼‚å¸¸åœºæ™¯
        if (address.equals(&quot;shanghai&quot;)) {
            throw new RuntimeException(&quot;rollback&quot;);
        }
        return user.getId();
    }
}
</code></pre>
<p>å†æ¬¡æŸ¥çœ‹æ—¥å¿—</p>
<pre><code class="language-shell">2024-08-04 16:47:30.838  INFO 55648 --- [nio-8080-exec-7] t.i.l.s.d.service.impl.UserServiceImpl   : æ·»åŠ ç”¨æˆ·å¼€å§‹
Creating a new SqlSession
Registering transaction synchronization for SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@7900e41a]
JDBC Connection [HikariProxyConnection@1080868530 wrapping conn0: url=jdbc:h2:~/mydb user=ROOT] will be managed by Spring
==&gt;  Preparing: INSERT INTO user ( id, username, address ) VALUES ( ?, ?, ? )
==&gt; Parameters: 1820018715891113985(String), yzt1(String), shanghai(String)
&lt;==    Updates: 1
Releasing transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@7900e41a]
2024-08-04 16:47:30.839  INFO 55648 --- [nio-8080-exec-7] t.i.l.s.d.service.impl.UserServiceImpl   : æ·»åŠ ç”¨æˆ·æˆåŠŸ, å‘é€äº‹ä»¶å¼€å§‹
2024-08-04 16:47:30.840  INFO 55648 --- [nio-8080-exec-7] t.i.l.s.demos.listener.UserListener      : æ¥æ”¶åˆ°æ·»åŠ ç”¨æˆ·äº‹ä»¶, å‘é€çŸ­ä¿¡å®Œæˆ Normal, user=User(id=1820018715891113985, username=yzt1, address=shanghai)
2024-08-04 16:47:30.840  INFO 55648 --- [nio-8080-exec-7] t.i.l.s.d.service.impl.UserServiceImpl   : æ·»åŠ ç”¨æˆ·æˆåŠŸ, å‘é€äº‹ä»¶ç»“æŸ
Transaction synchronization deregistering SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@7900e41a]
Transaction synchronization closing SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@7900e41a]
2024-08-04 16:47:30.842 ERROR 55648 --- [nio-8080-exec-7] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is java.lang.RuntimeException: rollback] with root cause

java.lang.RuntimeException: rollback
</code></pre>
<p>å› ä¸ºä¸‹æ¸¸çš„å¼‚å¸¸ï¼Œå¯¼è‡´äº‹åŠ¡å¹¶æ²¡æœ‰æˆåŠŸæäº¤ï¼Œä½†æ˜¯å‰é¢çš„äº‹ä»¶ç›‘å¬å™¨å·²ç»è¢«æ‰§è¡Œäº†ï¼Œæ­¤æ—¶æ•°æ®åº“æœªæ­£ç¡®å†™å…¥ç”¨æˆ·ï¼Œä½†æ˜¯çŸ­ä¿¡å·²ç»å‘é€å‡ºå»äº†ï¼Œåœ¨ä¸šåŠ¡ä¸Šè‚¯å®šæ˜¯ä¸å¯æ¥å—çš„ã€‚<br>
<strong>å½“ç„¶ä¹Ÿå¯ä»¥è¯´</strong>ï¼ŒæŠŠæ³¨å†Œç”¨æˆ·æˆåŠŸäº‹ä»¶æ”¾åˆ°ä»£ç çš„æœ€åé¢ï¼Œè¿™å½“ç„¶ä¹Ÿæ˜¯ä¸€ç§æ–¹æ¡ˆï¼Œä½†å§‹ç»ˆæ— æ³•åšåˆ°æœ€å®Œç¾çš„<strong>ä¸€è‡´æ€§</strong>é—®é¢˜ï¼Œå› ä¸ºç”¨æˆ·æœ€ç»ˆäº‹åŠ¡æäº¤è¿˜æ˜¯æœ‰å¯èƒ½å¤±è´¥ï¼ˆè¶…æ—¶ã€é‡å¤å†™å…¥ç­‰ï¼‰ã€‚<br>
<strong>æˆ–è€…è¯´</strong>ï¼Œå°†æ³¨å†ŒæˆåŠŸäº‹ä»¶æ”¾åˆ°äº‹åŠ¡æ³¨è§£çš„å¤–éƒ¨ï¼Œåœ¨ç¡®ä¿äº‹åŠ¡æäº¤ä¹‹åï¼Œå†å‘é€äº‹ä»¶ï¼Œå°±åƒä¹‹å‰å°†çš„Redisçš„åˆ†å¸ƒå¼é”è§£é”ä¸€æ · <a href="https://imyzt.top/post/shi-yong-redis-shi-xian-fen-bu-shi-suo-de-keng/#3-%E4%BA%8B%E5%8A%A1%E6%9C%AA%E6%8F%90%E4%BA%A4%E9%94%81%E5%B0%B1%E9%87%8A%E6%94%BE%E4%BA%86">ä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”çš„å‘#3-äº‹åŠ¡æœªæäº¤é”å°±é‡Šæ”¾äº†</a>ï¼Œè¿™ç§æ–¹æ¡ˆå›ºç„¶å¯ä»¥ï¼Œä½†ä½“ç°åˆ°ä¸šåŠ¡ä»£ç ä¸Šï¼Œå°±éœ€è¦å†å¦ä¸€ä¸ªè¢«Springä»£ç†äº†çš„beanä¸Šæ¥æ“ä½œï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚</p>
<p>å…¶å®Springæ˜¯ä¸ºè¿™ç§åœºæ™¯æä¾›äº†è§£å†³æ–¹æ¡ˆçš„ï¼Œé‚£å°±æ˜¯<code>@TransactionalEventListener</code>ï¼Œé€šè¿‡æ³¨è§£çš„åç§°å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œä»–æ˜¯ä¸ºäº†è§£å†³äº‹åŠ¡é—®é¢˜æ¥æä¾›çš„æ³¨è§£ï¼Œå®ƒçš„ä½¿ç”¨å’Œ<code>@EventListener</code>å®Œå…¨ä¸€è‡´ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªå‚æ•°<code>phase</code>ï¼Œå…±æœ‰4ä¸ªé€‰æ‹©ï¼š</p>
<ul>
<li>TransactionPhase.AFTER_COMMITï¼Œäº‹åŠ¡æäº¤ä¹‹å</li>
<li>TransactionPhase.BEFORE_COMMITï¼Œäº‹åŠ¡æäº¤ä¹‹å‰</li>
<li>TransactionPhase.AFTER_COMPLETIONï¼Œäº‹åŠ¡å®Œæˆä¹‹å</li>
<li>TransactionPhase.AFTER_ROLLBACKï¼Œäº‹åŠ¡å›æ»šä¹‹å<br>
é€šè¿‡åç§°å¯ä»¥å¾ˆç›´è§‚çš„çœ‹åˆ°ä»–çš„ä½œç”¨ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ·»åŠ 5ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œåˆ†åˆ«æ¥çœ‹çœ‹ä»–ä»¬å…·ä½“çš„æ‰§è¡Œæ—¶æœºï¼š</li>
</ul>
<pre><code class="language-java">public class UserListener {

    @EventListener(AddUserEvent.class)
    public void addHandler(AddUserEvent event) {
        User user = event.getUser();
        log.info(&quot;æ¥æ”¶åˆ°æ·»åŠ ç”¨æˆ·äº‹ä»¶, å‘é€çŸ­ä¿¡å®Œæˆ Normal, user={}&quot;, user.toString());
    }

    @TransactionalEventListener(value = AddUserEvent.class, phase = TransactionPhase.AFTER_COMMIT)
    public void addHandlerAfterCommit(AddUserEvent event) {
        User user = event.getUser();
        log.info(&quot;æ¥æ”¶åˆ°æ·»åŠ ç”¨æˆ·äº‹ä»¶, å‘é€çŸ­ä¿¡å®Œæˆ AFTER_COMMIT, user={}&quot;, user.toString());
    }

    @TransactionalEventListener(value = AddUserEvent.class, phase = TransactionPhase.BEFORE_COMMIT)
    public void addHandlerBeforeCommit(AddUserEvent event) {
        User user = event.getUser();
        log.info(&quot;æ¥æ”¶åˆ°æ·»åŠ ç”¨æˆ·äº‹ä»¶, å‘é€çŸ­ä¿¡å®Œæˆ BEFORE_COMMIT, user={}&quot;, user.toString());
    }

    @TransactionalEventListener(value = AddUserEvent.class, phase = TransactionPhase.AFTER_COMPLETION)
    public void addHandlerAfterCompletion(AddUserEvent event) {
        User user = event.getUser();
        log.info(&quot;æ¥æ”¶åˆ°æ·»åŠ ç”¨æˆ·äº‹ä»¶, å‘é€çŸ­ä¿¡å®Œæˆ AFTER_COMPLETION, user={}&quot;, user.toString());
    }

    @TransactionalEventListener(value = AddUserEvent.class, phase = TransactionPhase.AFTER_ROLLBACK)
    public void addHandlerAfterRollback(AddUserEvent event) {
        User user = event.getUser();
        log.info(&quot;æ·»åŠ ç”¨æˆ·äº‹åŠ¡æ‰§è¡Œå¤±è´¥, AFTER_ROLLBACK, user={}&quot;, user.toString());
    }
}
</code></pre>
<h3 id="æ‰§è¡Œä¸€æ¬¡æˆåŠŸçš„å†™å…¥çœ‹çœ‹æ—¥å¿—">æ‰§è¡Œä¸€æ¬¡æˆåŠŸçš„å†™å…¥ï¼Œçœ‹çœ‹æ—¥å¿—ã€‚</h3>
<pre><code class="language-shell">2024-08-04 17:02:09.069  INFO 56859 --- [nio-8080-exec-4] t.i.l.s.d.service.impl.UserServiceImpl   : æ·»åŠ ç”¨æˆ·å¼€å§‹
Creating a new SqlSession
Registering transaction synchronization for SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@3e9cf44b]
JDBC Connection [HikariProxyConnection@879009595 wrapping conn0: url=jdbc:h2:~/mydb user=ROOT] will be managed by Spring
==&gt;  Preparing: INSERT INTO user ( id, username, address ) VALUES ( ?, ?, ? )
==&gt; Parameters: 1820022399454720001(String), yzt1(String), shenzhen(String)
&lt;==    Updates: 1
Releasing transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@3e9cf44b]
2024-08-04 17:02:09.070  INFO 56859 --- [nio-8080-exec-4] t.i.l.s.d.service.impl.UserServiceImpl   : æ·»åŠ ç”¨æˆ·æˆåŠŸ, å‘é€äº‹ä»¶å¼€å§‹
2024-08-04 17:02:09.070  INFO 56859 --- [nio-8080-exec-4] t.i.l.s.demos.listener.UserListener      : æ¥æ”¶åˆ°æ·»åŠ ç”¨æˆ·äº‹ä»¶, å‘é€çŸ­ä¿¡å®Œæˆ Normal, user=User(id=1820022399454720001, username=yzt1, address=shenzhen)
2024-08-04 17:02:09.071  INFO 56859 --- [nio-8080-exec-4] t.i.l.s.d.service.impl.UserServiceImpl   : æ·»åŠ ç”¨æˆ·æˆåŠŸ, å‘é€äº‹ä»¶ç»“æŸ
Transaction synchronization committing SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@3e9cf44b]
2024-08-04 17:02:09.071  INFO 56859 --- [nio-8080-exec-4] t.i.l.s.demos.listener.UserListener      : æ¥æ”¶åˆ°æ·»åŠ ç”¨æˆ·äº‹ä»¶, å‘é€çŸ­ä¿¡å®Œæˆ BEFORE_COMMIT, user=User(id=1820022399454720001, username=yzt1, address=shenzhen)
Transaction synchronization deregistering SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@3e9cf44b]
Transaction synchronization closing SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@3e9cf44b]
2024-08-04 17:02:09.072  INFO 56859 --- [nio-8080-exec-4] t.i.l.s.demos.listener.UserListener      : æ¥æ”¶åˆ°æ·»åŠ ç”¨æˆ·äº‹ä»¶, å‘é€çŸ­ä¿¡å®Œæˆ AFTER_COMMIT, user=User(id=1820022399454720001, username=yzt1, address=shenzhen)
2024-08-04 17:02:09.072  INFO 56859 --- [nio-8080-exec-4] t.i.l.s.demos.listener.UserListener      : æ¥æ”¶åˆ°æ·»åŠ ç”¨æˆ·äº‹ä»¶, å‘é€çŸ­ä¿¡å®Œæˆ AFTER_COMPLETION, user=User(id=1820022399454720001, username=yzt1, address=shenzhen)
</code></pre>
<h3 id="å†æ‰§è¡Œä¸€æ¬¡å¤±è´¥çš„å†™å…¥çœ‹çœ‹æ—¥å¿—">å†æ‰§è¡Œä¸€æ¬¡å¤±è´¥çš„å†™å…¥ï¼Œçœ‹çœ‹æ—¥å¿—ï¼š</h3>
<pre><code class="language-shell">2024-08-04 17:09:30.720  INFO 56859 --- [nio-8080-exec-7] t.i.l.s.d.service.impl.UserServiceImpl   : æ·»åŠ ç”¨æˆ·å¼€å§‹
Creating a new SqlSession
Registering transaction synchronization for SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@4ef5b6da]
JDBC Connection [HikariProxyConnection@566058297 wrapping conn0: url=jdbc:h2:~/mydb user=ROOT] will be managed by Spring
==&gt;  Preparing: INSERT INTO user ( id, username, address ) VALUES ( ?, ?, ? )
==&gt; Parameters: 1820024251877470209(String), yzt1(String), shanghai(String)
&lt;==    Updates: 1
Releasing transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@4ef5b6da]
2024-08-04 17:09:30.722  INFO 56859 --- [nio-8080-exec-7] t.i.l.s.d.service.impl.UserServiceImpl   : æ·»åŠ ç”¨æˆ·æˆåŠŸ, å‘é€äº‹ä»¶å¼€å§‹
2024-08-04 17:09:30.722  INFO 56859 --- [nio-8080-exec-7] t.i.l.s.demos.listener.UserListener      : æ¥æ”¶åˆ°æ·»åŠ ç”¨æˆ·äº‹ä»¶, å‘é€çŸ­ä¿¡å®Œæˆ Normal, user=User(id=1820024251877470209, username=yzt1, address=shanghai)
2024-08-04 17:09:30.722  INFO 56859 --- [nio-8080-exec-7] t.i.l.s.d.service.impl.UserServiceImpl   : æ·»åŠ ç”¨æˆ·æˆåŠŸ, å‘é€äº‹ä»¶ç»“æŸ
Transaction synchronization deregistering SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@4ef5b6da]
Transaction synchronization closing SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@4ef5b6da]
2024-08-04 17:09:30.723  INFO 56859 --- [nio-8080-exec-7] t.i.l.s.demos.listener.UserListener      : æ¥æ”¶åˆ°æ·»åŠ ç”¨æˆ·äº‹ä»¶, å‘é€çŸ­ä¿¡å®Œæˆ AFTER_COMPLETION, user=User(id=1820024251877470209, username=yzt1, address=shanghai)
2024-08-04 17:09:30.723  INFO 56859 --- [nio-8080-exec-7] t.i.l.s.demos.listener.UserListener      : æ·»åŠ ç”¨æˆ·äº‹åŠ¡æ‰§è¡Œå¤±è´¥, AFTER_ROLLBACK, user=User(id=1820024251877470209, username=yzt1, address=shanghai)
2024-08-04 17:09:30.725 ERROR 56859 --- [nio-8080-exec-7] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is java.lang.RuntimeException: rollback] with root cause

java.lang.RuntimeException: rollback

</code></pre>
<h3 id="æ‰§è¡Œæµç¨‹">æ‰§è¡Œæµç¨‹</h3>
<p>é€šè¿‡ä¸Šé¢çš„æ—¥å¿—å¯ä»¥çœ‹åˆ°æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>
<img src="https://imyzt.top/post-images/1722762788539.png" alt="" loading="lazy"></p>
<p>ç”±æ­¤å¯çŸ¥ï¼Œæœ‰äº†<code>@TransactionalEventListener</code>ï¼Œæˆ‘ä»¬ä¸ç”¨ç¡®å®šäº‹åŠ¡çš„æäº¤æ—¶æœºä»¥åŠæ˜¯å¦æˆåŠŸï¼Œåªéœ€è¦ç¼–å†™å¯¹åº”çš„ç›‘å¬å™¨å¤„ç†å™¨ï¼Œå¹¶æŒ‡å®šæ‰§è¡Œæ—¶äº‹åŠ¡çš„æ—¶æœºå³å¯åœ¨æ­£ç¡®çš„æ—¶é—´ç‚¹è¢«è°ƒç”¨ï¼Œè¿™ä¸€åˆ‡éƒ½æ˜¯Springçš„AOPåœ¨å¸®æˆ‘ä»¬å¤„ç†ã€‚</p>
<p><code>TransactionalApplicationListenerMethodAdapter</code></p>
<pre><code class="language-java">public void onApplicationEvent(ApplicationEvent event) {
    if (TransactionSynchronizationManager.isSynchronizationActive() &amp;&amp;
            TransactionSynchronizationManager.isActualTransactionActive()) {
        TransactionSynchronizationManager.registerSynchronization(
                new TransactionalApplicationListenerSynchronization&lt;&gt;(event, this, this.callbacks));
    }
    else if (this.annotation.fallbackExecution()) {
        if (this.annotation.phase() == TransactionPhase.AFTER_ROLLBACK &amp;&amp; logger.isWarnEnabled()) {
            logger.warn(&quot;Processing &quot; + event + &quot; as a fallback execution on AFTER_ROLLBACK phase&quot;);
        }
        processEvent(event);
    }
    else {
        // No transactional event execution at all
        if (logger.isDebugEnabled()) {
            logger.debug(&quot;No transaction is active - skipping &quot; + event);
        }
    }
}
</code></pre>
<p>å¦‚æœæœ‰äº‹åŠ¡åœ¨è¿›è¡Œä¸­ï¼Œå°±å°†å…¶ç›‘å¬å™¨å¤„ç†å™¨å…ˆæ”¾åˆ°<code>TransactionSynchronizationManager</code>æ³¨å†Œä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—ï¼Œåœ¨äº‹åŠ¡æ‰§è¡Œåˆ°å¯¹åº”çš„é˜¶æ®µï¼Œå†å›è°ƒæ¯ä¸ªç›‘å¬äº†å¯¹åº”é˜¶æ®µçš„äº‹åŠ¡å¤„ç†å™¨ã€‚</p>
<p>åœ¨<code>AbstractPlatformTransactionManager#processCommit</code>ä¸­</p>
<pre><code class="language-java">protected final void triggerBeforeCommit(DefaultTransactionStatus status) {
    if (status.isNewSynchronization()) {
        TransactionSynchronizationUtils.triggerBeforeCommit(status.isReadOnly());
    }
}
protected final void triggerBeforeCompletion(DefaultTransactionStatus status) {
    if (status.isNewSynchronization()) {
        TransactionSynchronizationUtils.triggerBeforeCompletion();
    }
}
private void triggerAfterCommit(DefaultTransactionStatus status) {
    if (status.isNewSynchronization()) {
        TransactionSynchronizationUtils.triggerAfterCommit();
    }
}
</code></pre>
<h1 id="å°ç»“-2">å°ç»“</h1>
<p>é€šè¿‡æœ¬ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å¤§è‡´äº†è§£äº†<code>@TransactionalEventListener</code>æ³¨è§£çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ï¼Œä¹Ÿäº†è§£äº†å…¶å¤§æ¦‚çš„å®ç°åŸç†ï¼Œå…¶å®SpringEventçš„ç›¸å…³æºç çœ‹èµ·æ¥éå¸¸å®¹æ˜“ï¼Œåªè¦ç¨å¾®çœ‹è¿‡Springç›¸å…³æºç ï¼Œå¹¶ä¸”å¯¹SpringAOPç›¸å…³é€»è¾‘äº†è§£çš„ï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“çš„çœ‹æ‡‚ï¼Œå› ä¸ºä»–çš„è°ƒç”¨è¿‡ç¨‹æ²¡é‚£ä¹ˆå¤šå¼¯å¼¯ç»•ç»•ï¼Œåªè¦çœ‹ç€<code>applicationContext.publishEvent</code>æ–¹æ³•ä¸€ç›´å¾€ä¸‹ç›¯ï¼Œå¾ˆå¿«å°±èƒ½å¤Ÿçœ‹å®Œæ•´ä¸ªçš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p>
<p>æœ¬ç¯‡åšå®¢å¯¹åº”çš„æºç ï¼Œå¸Œæœ›èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼š<a href="https://github.com/imyzt/learning-technology-code/tree/master/dive-in-springboot-projects/spring-boot-events">spring-boot-events</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å½“Springå¤šå±‚åµŒå¥—äº‹åŠ¡é‡åˆ°Mybatis-Plusçš„saveBatch]]></title>
        <id>https://imyzt.top/post/dang-spring-duo-ceng-qian-tao-shi-wu-yu-dao-mybatis-plus-de-savebatch/</id>
        <link href="https://imyzt.top/post/dang-spring-duo-ceng-qian-tao-shi-wu-yu-dao-mybatis-plus-de-savebatch/">
        </link>
        <updated>2024-07-27T10:48:23.000Z</updated>
        <content type="html"><![CDATA[<h1 id="å‰è¨€">å‰è¨€</h1>
<p>äº‹æƒ…çš„èµ·å› è¿˜è¦ä» <code>Transaction rolled back because it has been marked as rollback-only] with root cause</code> è¯´èµ·ï¼Œå…¬å¸çš„ä¸€ä¸ªä¸šåŠ¡ï¼ŒKafka Consumeræ¶ˆè´¹äº†æ¥è‡ªä¸Šæ¸¸çš„æ¶ˆæ¯å¤„ç†å¹¶å†™å…¥æ•°æ®ï¼Œæ•´ä¸ªé€»è¾‘å¾ˆå¤æ‚ï¼Œç”±æœ€å¤–å±‚çš„æ–¹æ³•æ³¨è§£ <code>@Transactional(rollbackFor = Exception.class)</code> æ¥ä¿è¯æ•´ä¸ªè¿‡ç¨‹æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä½†å…¶ä¸­æœ‰ä¸€ä¸ªä¸šåŠ¡ä¸éœ€è¦äº‹åŠ¡ä¿è¯ï¼Œæ‰€ä»¥<strong>å‰äºº</strong>å†™äº†ä¸€ä¸ª <code>try catch</code> æ¥é˜²æ­¢å­ä¸šåŠ¡æµå¼‚å¸¸é˜»æ–­å…¨å±€äº‹åŠ¡çš„æäº¤ã€‚ç®€åŒ–åå¤§æ¦‚ç±»ä¼¼äºè¿™æ ·ï¼š</p>
<pre><code class="language-java">@Service
public class ServiceA {

    @Resource
    private ServiceB serviceB;
    @Resource
    private CompanyService companyService;

    /**
     * æ¨¡æ‹Ÿæ¶ˆè´¹å¤–éƒ¨çš„æ¶ˆæ¯, è°ƒç”¨è€…A
     */
    @Transactional(rollbackFor = Exception.class)
    public void test(String username) {
        // 1. é¦–å…ˆä¿å­˜è‡ªå·±çš„æ•°æ®, æ¨¡æ‹Ÿä¸šåŠ¡æ“ä½œ
        Company company = new Company();
        company.setName(&quot;å®¶é‡Œè¹²&quot;);
        company.setAddress(&quot;localhost&quot;);
        companyService.save(company);

        // 2. ç„¶åè°ƒç”¨Springçš„ä»£ç†æ–¹æ³•B
        serviceB.doBusiness(username);
    }
}

@Service
public class ServiceB {

    @Resource
    private UserService userService;

    @Transactional(rollbackFor = Exception.class)
    public void doBusiness(String username) {
        // 3. è¿™é‡Œè¿˜æœ‰ä¸€ç³»åˆ—äº‹åŠ¡æ“ä½œ, ä½†å’Œè¿™æ¬¡é—®é¢˜æ— å…³, å°±ä¸æ”¾è¿™é‡Œå¹²æ‰°äº†
        try {
            User user = new User();
            user.setUsername(username);
            user.setAddress(&quot;shenzhen&quot;);
            // 4. ç½ªé­ç¥¸é¦–çš„ä»£ç , æ­¤å¤„å‰äººä¸ºäº†ä¸å¹²æ‰°ä¸»é€»è¾‘, catchäº†å¼‚å¸¸
            // ä¸ºäº†è¾¾åˆ°&quot;ä»¥ä¸ºçš„&quot;å¼‚å¸¸ä¸å¹²æ‰°å¤–éƒ¨äº‹åŠ¡
            userService.saveBatch(Collections.singletonList(user));
        } catch (DuplicateKeyException e) {
            // 5. æ­¤å¤„æœ‰æ—¥å¿— log.error(&quot;xxxä¸šåŠ¡å¼‚å¸¸&quot;, e)
            e.printStackTrace();
        }
    }
}
</code></pre>
<p>ä¸Šé¢çš„ä»£ç çœ‹èµ·æ¥å¹³å¹³æ— å¥‡ï¼ŒæŒ‰ç…§â€œå¸¸è§„â€ç†è§£ï¼Œ<strong>ä»£ç å—4</strong>ä½ç½®çš„æµç¨‹å¼‚å¸¸ï¼Œä¸ä¼šå¹²æ‰°<strong>ä»£ç å—1ã€3</strong>å¤„çš„äº‹åŠ¡æäº¤ï¼Œè¾¾åˆ°ç¼–å†™è€…çš„ç›®çš„ã€‚</p>
<p>ä½†å¦‚æœæ˜¯è¿™ä¹ˆç®€å•ï¼Œæˆ‘ä¹Ÿä¸ä¼šæœ‰è¿™æ¬¡é—®é¢˜çš„æ’æŸ¥è¿‡ç¨‹ï¼Œä¹Ÿä¸ä¼šæœ‰è¿™ç¯‡ç¬”è®°äº†...</p>
<h1 id="ç°è±¡">ç°è±¡</h1>
<p>æˆ‘ä»¬ä»æ—¥å¿—ç›‘æ§æ³¨æ„åˆ°ï¼Œ<strong>ä»£ç å—5</strong>æœ‰é¢‘ç¹çš„å¼‚å¸¸ï¼Œå¹¶ä¸”<strong>ä»£ç å—1ã€3</strong>çš„æ•°æ®æœ€ç»ˆå¹¶æœªå†™å…¥æˆåŠŸï¼Œé€šè¿‡MySQLè¿½è¸ªäº‹åŠ¡å‘ç°ï¼Œ1ã€3å¤„çš„è¯­å¥æ‰§è¡Œåï¼Œå‡è¢«<code>rollback</code>äº†ã€‚<br>
è¿™å°±å¼•å‡ºäº†å‰è¨€ä¸­çš„é—®é¢˜åˆ†ææ¥äº†ï¼Œåœ¨æ²¡æœ‰ç¡®è®¤é—®é¢˜å‡ºç°åœ¨<strong>ä»£ç å—4</strong>æ—¶ï¼Œè¿˜åœ¨æ‰¾å“ªäº›åœ°æ–¹æœ‰å¼‚å¸¸å¯èƒ½é€ æˆå›æ»šï¼Œä½†é€šè¿‡è·Ÿè¸ªç¨‹åºæ—¥å¿—å‘ç°ï¼Œ1ã€3å¤„è¢«å›æ»šçš„æ•°æ®ï¼ŒåŸºæœ¬éƒ½å‘ç”Ÿåœ¨ä»£ç å—5çš„æ—¥å¿—æ‰“å°å‡ºæ¥ä¹‹åï¼Œå¹¶ä¸”ç¨‹åºä¸­ä¹Ÿå‘ç°äº†ä¸‹é¢çš„å¼‚å¸¸ï¼š</p>
<pre><code class="language-java">
org.springframework.transaction.UnexpectedRollbackException: Transaction rolled back because it has been marked as rollback-only
.......
</code></pre>
<p><strong>Transaction rolled back because it has been marked as rollback-only</strong>ï¼Œè¯´æ˜äº‹åŠ¡è¢«æ ‡è®°ä¸ºåªèƒ½å›æ»šï¼Œå¹¶ä¸”æ ¹æ®è¡Œå·ï¼ˆä¸Šè¿°å †æ ˆæœªæ ‡æ³¨ä¸šåŠ¡è¡Œå·ï¼‰æ¨æ–­å‡ºï¼Œæ˜¯å‘ç”Ÿä»£ç å—2å¤„ï¼Œè°ƒç”¨<code>doBusiness</code>æ–¹æ³•å‘ç”Ÿäº†å›æ»šã€‚</p>
<h1 id="åˆ†æ">åˆ†æ</h1>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒSpringæœ¬èº«æ²¡æœ‰äº‹åŠ¡ï¼Œåªæœ‰æ•°æ®åº“æœ‰äº‹åŠ¡ï¼ŒSpringæä¾›<code>@Transactional</code>ä»¥åŠäº‹åŠ¡ä¼ æ’­æœºåˆ¶ï¼Œåªæ˜¯åˆ©ç”¨æ•°æ®åº“ç»™æˆ‘ä»¬æä¾›çš„ <code>begin/commit/rollback</code> æ¥ç»“åˆ Spring AOP å®ç°çš„<strong>ç»Ÿä¸€äº‹åŠ¡ç®¡ç†</strong>ï¼Œé€šè¿‡ <code>PlatformTransactionManager</code> å·¥å…·ç±»æ¥å®ç°å¯¹äº‹åŠ¡çš„ç®¡ç†ã€‚ï¼ˆè¿™æ–¹é¢ç½‘ä¸Šä¼˜ç§€çš„åšå®¢å¤ªå¤šäº†ï¼Œå°±ä¸ç»†è®²äº†ï¼Œç›¸ä¿¡æ¯ä¸€ä¸ªSpring Boyéƒ½ç†ŸçŸ¥ï¼‰</p>
<p>é‚£ä¹ˆï¼Œç»“åˆå¯¹Springäº‹åŠ¡ç®¡ç†å™¨å’ŒAOPçš„ç†è§£ï¼Œæˆ‘ä»¬ç”»ä¸€å¼ å›¾æ¥ç†è§£ä¸Šé¢è¿™ä¸ªâ€œåµŒå¥—äº‹åŠ¡â€çš„è¿‡ç¨‹ã€‚<br>
<img src="https://imyzt.top/post-images/1722091980572.png" alt="" loading="lazy"></p>
<p>ç»“åˆæµç¨‹å›¾æ¥åˆ†æï¼ŒæŒ‰â€œå¸¸ç†â€ç†è§£çš„è¯ï¼Œ<code>catch</code> äº† <code>userService.saveBatch</code>ï¼Œå†…éƒ¨çš„å¼‚å¸¸å°±ä¸ä¼šé€ æˆå¤–é¢çš„å›æ»šï¼Œå› ä¸ºå¼‚å¸¸â€œè¢«â€åäº†ã€‚</p>
<p><strong>ä½†å®åˆ™ä¸ç„¶</strong>ï¼ŒSpringäº‹åŠ¡ç®¡ç†å™¨é‡‡ç”¨çš„æ˜¯ <strong>æ ‡è®°ä½Savepoint</strong> æ–¹æ³•ï¼Œåªè¦è¢«äº‹åŠ¡ç®¡ç†å™¨æ„ŸçŸ¥åˆ°äº†å¼‚å¸¸å‡ºç°ï¼Œå°±ä¼šå°†å½“å‰çº¿ç¨‹çš„äº‹åŠ¡æ ‡è®°æˆä¸º<code>rollbackOnly</code>çŠ¶æ€ï¼Œåé¢çš„äº‹åŠ¡å†æƒ³æäº¤å°±ä¸è¡Œäº†ã€‚è¿™ä¹Ÿå°±å¯¼è‡´äº†<code>ServiceB.doBusiness</code>æ–¹æ³•åœ¨â€œæƒ³è¦â€æäº¤äº‹åŠ¡æ—¶ï¼Œå‘ç°äº†äº‹åŠ¡å·²ç»è¢«æ ‡è®°äº†ï¼Œå°±æŠ›å‡ºäº†<code>UnexpectedRollbackException</code>å¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸è¿›ä¸€æ­¥çš„é€ æˆäº†<code>ServiceA.test</code>æ–¹æ³•çš„ä»£ç†ç±»æ£€æµ‹åˆ°äº†å¼‚å¸¸ï¼Œ<code>ServiceA.test</code>çš„ä»£ç†ç±»ä¹Ÿå¼€å§‹å¤„ç†å›æ»šï¼Œè¿›ä¸€æ­¥é€ æˆäº†æ•´ä¸ª <code>Kafka Consumer</code>çš„äº‹åŠ¡é€ æˆäº†å›æ»šã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://imyzt.top/post-images/1722092797622.png" alt="" loading="lazy"></figure>
<h1 id="æºç ">æºç </h1>
<p>é€šè¿‡æœç´¢â€œTransaction rolled back because it has been marked as rollback-onlyâ€å¼‚å¸¸ï¼Œå¯ä»¥å¾ˆå¿«å®šä½åˆ°å¼‚å¸¸æµç¨‹åœ¨æºç ä¸­çš„ä½ç½®ï¼Œ<code>org.springframework.transaction.support.AbstractPlatformTransactionManager#processRollback</code><br>
è€Œé€šè¿‡è·Ÿè¸ªè¯¥æ–¹æ³•çš„è°ƒç”¨æ–¹ï¼Œå¯ä»¥å¾ˆå¿«å®šä½åˆ°<code>org.springframework.transaction.support.AbstractPlatformTransactionManager#commit</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ­£å°è¯æˆ‘ä»¬ä¸Šæ–¹çš„ <code>ServiceB.doBusiness</code>æƒ³è¦ <code>commit</code>çš„æ—¶å€™ï¼Œ<code>defStatus.isGlobalRollbackOnly()</code>æ£€æµ‹åˆ°å½“å‰äº‹åŠ¡å·²ç»è¢«æ ‡è®°äº†<code>rollbackOnly</code>(<code>org.springframework.transaction.support.ResourceHolderSupport#rollbackOnly</code>)</p>
<figure data-type="image" tabindex="2"><img src="https://imyzt.top/post-images/1722094564627.png" alt="" loading="lazy"></figure>
<h1 id="è§£å†³">è§£å†³</h1>
<p>å…¶å®è¯¥é—®é¢˜åœ¨åˆ†æä¹‹åˆï¼Œå¤§å®¶å¹¶æ²¡æœ‰å®šä½åˆ°æ˜¯å› ä¸º<code>userService.saveBatch()</code>ä¸Šé¢æœ‰Mybatis-PlusåŠ çš„<code>@Transactional</code>æ³¨è§£å¹²æ‰°åˆ° <code>catch</code> å¼‚å¸¸è¿™ä¹ˆé¡ºåˆ©ï¼Œè€Œæ˜¯éƒ½åœ¨æ€€ç–‘ï¼šä¸ºä»€ä¹ˆæˆ‘catchäº†ï¼Œè¿˜æŠŠæˆ‘ä¸Šå±‚çš„äº‹åŠ¡ç»™å›æ»šäº†ï¼åé¢è™½ç„¶æ€€ç–‘åˆ°<code>userService.saveBatch()</code>çš„äº‹åŠ¡æ³¨è§£äº†ï¼Œåˆè§‰å¾— <code>try</code> é‡Œé¢çš„äº‹åŠ¡ï¼Œä¸ä¼šå½±å“åˆ°å¤–å±‚ï¼ˆæ²¡æœ‰æƒ³åˆ°æ ‡è®°ä½rollbackOnlyè¿™é‡Œï¼‰ï¼Œåé¢åˆæƒ³åˆ°æ˜¯ä¸æ˜¯å¯ä»¥åœ¨<code>ServiceB.doBusiness()</code>ä¸Šè°ƒæ•´äº‹åŠ¡ä¼ æ’­æœºåˆ¶ä¸º<code>Propagation.REQUIRES_NEW</code>ï¼Œä½†å…¶å®éƒ½æ˜¯å¾’åŠ³ï¼Œå› ä¸ºå§‹ç»ˆéƒ½å·²ç»è¢«Mybatis-Plusçš„<code>@Transactional</code>æ ‡è®°ä¸º<code>rollbackOnly</code>äº†ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>è°ƒç”¨æ— äº‹åŠ¡æ³¨è§£çš„<code>save()</code>æ–¹æ³•</li>
<li>æ”¹ç”¨<code>Db.saveBatch</code>æ–¹æ³•</li>
<li>æ”¹ç”¨å¼‚æ­¥çº¿ç¨‹ï¼ˆåˆ‡æ¢äº†äº‹åŠ¡ç®¡ç†å™¨ï¼‰å¤„ç† try ä¸­çš„æµç¨‹</li>
</ol>
<h1 id="åè®°">åè®°</h1>
<p>ä¸‹é¢è¿™ç¯‡æ–‡ç« ï¼Œåœ¨æˆ‘ä»¬æ’æŸ¥é—®é¢˜çš„è¿‡ç¨‹ä¸­ï¼Œç»™äº†å¾ˆå¤§çš„å¸®åŠ©ï¼Œå¸®æˆ‘ä»¬ç¡®å®šäº†é—®é¢˜çš„æ–¹å‘ï¼š<br>
<a href="https://blog.csdn.net/github_38592071/article/details/131950392">å‘Šè­¦ï¼šMyBatis-Plusä¸­æ…ç”¨@Transactionalæ³¨è§£ï¼Œå‘çš„å·®ç‚¹è¢«å¼€äº†...</a></p>
<p>å…³äºæ˜¯å¦å¯ä»¥å–æ¶ˆ<code>saveBatch</code>æ–¹æ³•ä¸Šäº‹åŠ¡æ³¨è§£çš„è®¨è®ºï¼Œå¯ä»¥çœ‹Mybatis-Pluså®˜æ–¹çš„issueåŒºï¼š<br>
ï¼ˆ3.5.7ä¹‹åï¼Œå–æ¶ˆäº†IServiceï¼Œéƒ½ä½¿ç”¨Mapperæ–¹æ³•ï¼Œå½»åº•è§£å†³.......ï¼‰</p>
<ol>
<li><a href="https://github.com/baomidou/mybatis-plus/issues/6333">å»ºè®®å–æ¶ˆæ•°æ®å±‚çš„saveBatchç­‰æ–¹æ³•çš„@Transactionalæ³¨è§£ï¼Œäº¤ç”±ä¸šåŠ¡å±‚è‡ªè¡Œç®¡ç† #6333</a></li>
<li><a href="https://github.com/baomidou/mybatis-plus/issues/5108">saveBatchä¸‹çš„äº‹åŠ¡é—®é¢˜</a></li>
</ol>
<p>æˆ‘æ–°å»ºäº†ä¸€ä¸ªå·¥ç¨‹ï¼Œç”¨æ¥å¤ç°è¯¥é—®é¢˜ï¼š<br>
<a href="https://github.com/imyzt/learning-technology-code/tree/master/error-case-analysis/adoptopenjdk-poi-crash-demo">å¤ç°å®šä½Springå¤šå±‚åµŒå¥—äº‹åŠ¡é—®é¢˜</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[MySQL GROUP BY éšå¼æ’åº]]></title>
        <id>https://imyzt.top/post/mysql-group-by-yin-shi-pai-xu/</id>
        <link href="https://imyzt.top/post/mysql-group-by-yin-shi-pai-xu/">
        </link>
        <updated>2024-07-17T15:33:42.000Z</updated>
        <content type="html"><![CDATA[<h1 id="å‰è¨€">å‰è¨€</h1>
<p>åœ¨MySQLçš„è€ç‰ˆæœ¬ï¼ˆMySQL5.7åŠä»¥å‰ï¼‰ä¸­ï¼Œ <code>GROUP BY xxx</code> ç­‰åŒäº <code>GROUP BY xxx ORDER BY xxx</code>ï¼Œåœ¨ <code>GROUP BY</code> çš„åŒæ—¶ï¼Œä¼šè‡ªå¸¦æ’åºçš„æ•ˆæœã€‚åŒ…æ‹¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ’åº <code>GROUP BY xxx DESC</code>ï¼Œç­‰åŒäº <code>GROUP BY xxx ORDER BY xxx DESC</code>ã€‚</p>
<p>MySQL8.0 ç‰ˆæœ¬åˆ é™¤äº†éšå¼æ’åºï¼ŒåŒ…æ‹¬æ˜¾ç¤ºæ’åºä¹ŸæŠ¥é”™ã€‚åœ¨å‡çº§åˆ°MySQL8.0ä¹‹åï¼Œç”±äºç¼ºå°‘äº†éšå¼æ’åºï¼Œå¯èƒ½ä¼šé€ æˆæŸ¥è¯¢ç»“æœè¿”å›çš„é¡ºåºä¸ç¨³å®šï¼Œé€ æˆç»“æœä¸æ»¡è¶³é¢„æœŸã€‚</p>
<h1 id="é—®é¢˜ç°è±¡">é—®é¢˜ç°è±¡</h1>
<ol>
<li>aliyun PolarDB MySQL ç‰ˆ 8.0.1.1.40ç‰ˆæœ¬ï¼Œåœ¨DMSæŸ¥è¯¢æ—¶ï¼Œ<strong>è¿”å›çš„é¡ºåºç¨³å®š</strong>ã€‚</li>
<li>åœ¨ç¨‹åºJDBCæŸ¥è¯¢æ—¶ï¼ˆè¿æ¥çš„é›†ç¾¤åœ°å€ï¼‰ï¼Œè¿”å›çš„ç»“æœå¤šæ¬¡æŸ¥è¯¢é¡ºåºä¸ä¸€è‡´ã€‚</li>
</ol>
<p>ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯PolarDB 8.0+ï¼Œé¦–å…ˆå¼€å§‹æ€€ç–‘æ˜¯ä¸æ˜¯aliyunåšäº†ä»€ä¹ˆæ“ä½œï¼ŒæŸ¥åˆ°ä»–ä»¬çš„æ›´æ–°æ—¥å¿—ï¼šhttps://help.aliyun.com/zh/polardb/polardb-for-mysql/polardb-for-mysql-8-0-1ï¼Œå‘ç°ä»–ä»¬åœ¨8.0ç‰ˆæœ¬ä¸­ï¼Œå°†éšå¼æ’åºçš„åŠŸèƒ½åˆåŠ äº†å›æ¥ï¼Œé‚£ä¹ˆæ›´è¿›ä¸€æ­¥è¯æ˜é—®é¢˜å‡ºç°åœ¨æ•°æ®åº“å±‚é¢äº†ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://imyzt.top/post-images/1721315576799.png" alt="" loading="lazy"></figure>
<p>æœ‰äº†ä¸Šé¢çš„åˆ†æå’Œæ›´æ–°æ—¥å¿—ï¼Œæˆ‘ä»¬åˆè¿›è¡Œäº†æ¥ä¸‹æ¥çš„å‡ æ¬¡æµ‹è¯•ï¼Œè¿›ä¸€æ­¥ç¼©å°é—®é¢˜èŒƒå›´ï¼Œå®šä½é—®é¢˜çš„æ ¹æœ¬åŸå› ã€‚</p>
<ol>
<li>é€šè¿‡MySQLå‘½ä»¤è¡Œï¼Œè¿æ¥åˆ°é›†ç¾¤åœ°å€ï¼Œè¿”å›çš„ç»“æœå¤šæ¬¡æŸ¥è¯¢é¡ºåºä¸ä¸€è‡´ã€‚</li>
<li>é€šè¿‡MySQLå‘½ä»¤è¡Œï¼Œè¿æ¥åˆ°ä¸»èŠ‚ç‚¹åœ°å€ï¼Œ<strong>è¿”å›çš„é¡ºåºç¨³å®š</strong>ã€‚</li>
<li>é€šè¿‡MySQLå‘½ä»¤è¡Œï¼Œè¿æ¥åˆ°åªè¯»ä»èŠ‚ç‚¹åœ°å€ï¼Œè¿”å›çš„ç»“æœå¤šæ¬¡æŸ¥è¯¢é¡ºåºä¸ä¸€è‡´ã€‚</li>
</ol>
<p>é€šè¿‡å’¨è¯¢aliyunå·¥ç¨‹å¸ˆï¼Œäº†è§£åˆ°DMSé»˜è®¤æ˜¯ç›´è¿ä¸»åº“çš„ï¼Œç»“åˆä¸Šè¿°ä¸‰ä¸ªæ‰§è¡Œç»“æœæ¥çœ‹ï¼Œä¼¼ä¹é—®é¢˜å‡ºç°åœ¨äº†ä»åº“ï¼Œå½“è¯·æ±‚ä»ä»åº“æ‰§è¡Œæ¥çœ‹ï¼Œé¡ºåºæ€»æ˜¯ä¸ä¸€è‡´ã€‚</p>
<p>æœ‰äº†ä¸Šè¿°çš„ç»“è®ºï¼Œé€šè¿‡è¿›ä¸€æ­¥å’¨è¯¢aliyunçš„å·¥ç¨‹å¸ˆï¼Œæœ€ç»ˆå®šä½åˆ°é—®é¢˜æ˜¯å› ä¸ºå…¶ä¸­æœ‰å°ä»åº“å¼€å¯äº†å¹¶è¡ŒæŸ¥è¯¢ï¼Œå¯¼è‡´äº†è¿”å›é¡ºåºä¼šå­˜åœ¨å¤šæ¬¡æŸ¥è¯¢ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
<p><img src="https://imyzt.top/post-images/1721489241076.jpeg" alt="" loading="lazy"><br>
<img src="https://imyzt.top/post-images/1721489235249.jpeg" alt="" loading="lazy"></p>
<h1 id="æ€»ç»“">æ€»ç»“</h1>
<p>è™½ç„¶æœ€ç»ˆå®šä½åˆ°äº†åŸå› æ˜¯å¹¶è¡ŒæŸ¥è¯¢å¯¼è‡´çš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯è®¤ä¸ºï¼Œæ—¢ç„¶aliyunçš„ç‰ˆæœ¬å…¬å‘Šä¸­å·²ç»è¯´æ˜äº†åŠ å›äº† <code>GROUP BY</code> éšå¼æ’åºåŠŸèƒ½ï¼Œé‚£ä¹ˆä¸ç®¡æ˜¯å¹¶è¡ŒæŸ¥è¯¢è¿˜æ˜¯ä»€ä¹ˆåŸå› ï¼Œå°±ç®—æ˜¯åœ¨ MySQL Serverå±‚è¿›è¡Œæ±‡æ€»æ’åºï¼Œä¹Ÿéœ€è¦ä¿è¯æœ€ç»ˆç»“æœå’Œé¢„æœŸä¸€è‡´ï¼Œå¦åˆ™ä¼šé€ æˆä½¿ç”¨æ–¹çš„é¢„æœŸä¸æ»¡è¶³ã€‚<br>
å…¶æ¬¡ï¼Œå¯¹äºéšå¼æ’åºè‚¯å®šä¸èƒ½è¿›è¡Œä¾èµ–ï¼Œè¿˜æ˜¯å›å½’åˆ°ç¨‹åºä¸Šï¼Œä¸è®ºä»€ä¹ˆæƒ…å†µè‚¯å®šä¸èƒ½ä¾èµ–äºçº¦å®šä¿—æˆçš„ä¸€äº›åŠŸèƒ½ï¼Œåº”è¯¥å¼ºä¾èµ–è‡ªå·±å†™ä¸‹çš„æŒ‡ä»¤ï¼Œæ¯”å¦‚æ‰‹åŠ¨æŒ‡å®š <code>ORDER BY</code>  æ¯”äº‹åå»åˆ†æè¿˜æ˜¯å¥½å¾ˆå¤šã€‚ä½†æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯å­¦ä¹ åˆ°ä¸å°‘ä¸œè¥¿ï¼Œè¿˜æ˜¯æœ‰ä¸€å®šæ”¶è·çš„ã€‚</p>
<h1 id="æ‰©å±•">æ‰©å±•</h1>
<h2 id="æ—§ç‰ˆæœ¬ä¸ºä»€ä¹ˆä¼šæœ‰æ’åº">æ—§ç‰ˆæœ¬ä¸ºä»€ä¹ˆä¼šæœ‰æ’åºï¼Ÿ</h2>
<p>å› ä¸ºè¦å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„çš„è¯ï¼Œæœ¬èº«ä¹Ÿä¼šå¯¹åˆ†ç»„å‰çš„æ•°æ®è¿›è¡Œæ’åºï¼Œé™ä½æ•°æ®å¤æ‚åº¦ï¼Œæ‰€ä»¥åŸå§‹æ•°æ®æœ¬èº«å°±å·²ç»æœ‰åºäº†ã€‚<br>
å…¶æ¬¡ï¼Œå¦‚æœæ˜¯ <code>GROUP BY</code> çš„ä¸€ä¸ªç´¢å¼•å­—æ®µï¼Œé‚£ä¹ˆç´¢å¼•å­—æ®µæœ¬èº«æ˜¯ B+ Trreeï¼Œæœ¬èº«ä¹Ÿæ˜¯æœ‰åºçš„ï¼Œä¸”å¹³æ—¶ <code>GROUP BY</code>çš„å­—æ®µå¤§æ¦‚ç‡æ˜¯æœ‰ç´¢å¼•çš„ï¼ˆå¦åˆ™æ•ˆç‡å¤ªä½äº†ï¼‰ï¼Œæ‰€ä»¥ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ—§ç‰ˆæœ¬çš„ <code>GROUP BY</code> å°±ä¸ºæˆ‘ä»¬ä¿ç•™äº†æ’åºã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆè¦åˆ é™¤éšå¼æ’åº">ä¸ºä»€ä¹ˆè¦åˆ é™¤éšå¼æ’åºï¼Ÿ</h2>
<p>ä¼šé€ æˆé¢„æœŸå¤–çš„ç»“æœï¼Œæ¯”å¦‚æ²¡æœ‰æ˜ç¡®æŒ‡å®š</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[SpringBoot 3.3 + Neo4j 5.1 + Java17 æ¥å…¥æ•™ç¨‹]]></title>
        <id>https://imyzt.top/post/springboot-33-neo4j-51-java17-jie-ru-jiao-cheng/</id>
        <link href="https://imyzt.top/post/springboot-33-neo4j-51-java17-jie-ru-jiao-cheng/">
        </link>
        <updated>2024-06-30T09:00:27.000Z</updated>
        <content type="html"><![CDATA[<p>å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://docs.spring.io/spring-data/neo4j/docs/current-SNAPSHOT/reference/html/">Spring Data Neo4j</a></p>
<p>åŸºäºå®˜æ–¹æ–‡æ¡£ï¼ŒåŸºæœ¬å°±èƒ½å®ŒæˆåŸºæœ¬çš„æ¥å…¥ï¼ŒNeo4jçš„ç‰ˆæœ¬å¾ˆä¹±ï¼Œå¦‚æœä½¿ç”¨SpringBoot2.+çš„è¯ï¼Œä¸€å®šè¦æ³¨æ„Neo4j Serverçš„ç‰ˆæœ¬ä¸Driverçš„åŒ¹é…å…³ç³»ï¼Œå¦åˆ™å¾ˆå®¹æ˜“è¸©å‘ã€‚ ç”±äºæˆ‘ä¸æ˜¯ç”Ÿäº§ä½¿ç”¨ï¼Œç›´æ¥ç”¨å®˜æ–¹æœ€æ–°åå€’æ˜¯æ²¡é‡åˆ°æ­¤ç±»é—®é¢˜ï¼Œä½†ç½‘ä¸Šå¯¹äºè¿™ä¸ªé—®é¢˜é‡åˆ°çš„å¾ˆå¤šã€‚</p>
<h1 id="ç®€å•æ¥å…¥">ç®€å•æ¥å…¥</h1>
<p>å†™äº†å‡ ä¸ªå•æµ‹ï¼Œçœ‹äº†ä¸‹æµç¨‹ï¼Œå¾—ç›ŠäºSpringBoot-Dataçš„å°è£…ï¼Œå’Œæ“ä½œMongoDBã€MySQLç­‰å…³ç³»å‹æ•°æ®åº“åŸºæœ¬æ— å¼‚ï¼Œä½¿ç”¨è¿‡ç¨‹å¾ˆä¸æ»‘ã€‚</p>
<pre><code class="language-java">@Test
    public void readAll() {
        List&lt;Person&gt; personList = personRepository.findAll();
        Assert.isTrue(!personList.isEmpty(), &quot;isEmpty&quot;);
    }

    @Test
    public void delById() {
        personRepository.findById(71L).ifPresent(person -&gt; {
            System.out.println(&quot;before delete: &quot; + person.getName());
        });
        personRepository.deleteById(71L);
        Person person = personRepository.findById(71L).orElse(null);
        System.out.println(&quot;after delete: &quot; + person);
    }

    @Test
    public void save() {
        Person person = new Person();
        person.setName(&quot;äººå‚æœæ ‘&quot;);
        personRepository.save(person);
    }
</code></pre>
<ol>
<li>findAll<br>
<img src="https://imyzt.top/post-images/1719738560721.png" alt="" loading="lazy"></li>
<li>delById<br>
åˆ é™¤å‰ï¼š<br>
<img src="https://imyzt.top/post-images/1719738566977.png" alt="" loading="lazy"><br>
åˆ é™¤åï¼š<br>
<img src="https://imyzt.top/post-images/1719738573248.png" alt="" loading="lazy"></li>
<li>saveOne<br>
<img src="https://imyzt.top/post-images/1719738577960.png" alt="" loading="lazy"></li>
</ol>
<h1 id="å…³ç³»çš„åˆ›å»º">å…³ç³»çš„åˆ›å»º</h1>
<p>å¯¹äºèŠ‚ç‚¹çš„åŸºæœ¬æŸ¥è¯¢ï¼Œç”±äºå…¶ç»“æ„ç±»ä¼¼äºç»“æ„æ€§ï¼Œå’Œç»“æ„æ€§æ•°æ®åº“æŸ¥è¯¢æ— å¼‚ï¼Œä½†æ˜¯å¯¹äºN4o4jç‰¹æ®Šçš„å…³ç³»ç»“æ„ï¼Œå°±æœ‰ä¸€äº›ä¸ä¸€æ ·äº†ã€‚</p>
<pre><code class="language-java">
@Repository
public interface PersonRepository extends Neo4jRepository&lt;Person, Long&gt; {

    Person findByName(String name);

    /**
     * åˆ›å»ºäººç‰©å…³ç³»
     * @param from æº
     * @param relation å…³ç³»
     * @param to ç›®æ ‡
     */
    @Query(&quot;match (n:person {name: $from}),(m:person {name: $to}) &quot; +
            &quot;create (n)-[:è¥¿æ¸¸äººç‰©å…³ç³»{relation:$relation}]-&gt;(m)&quot;)
    void createRelation(String from, String relation, String to);
}


@SpringBootTest
public class PersonRelationShipRepositoryTest {
    @Resource
    private PersonRepository personRepository;
    @Test
    public void addRelation() {
        Person personYangjian = personRepository.findByName(&quot;æ¨æˆ¬&quot;);
        Person person2 = new Person();
        person2.setName(&quot;ç‰é¼çœŸäºº&quot;);
        PersonRelationShip relationShip = new PersonRelationShip();
        relationShip.setChild(person2);
        relationShip.setRelation(&quot;å¸ˆå‚…&quot;);
        personYangjian.getPersonRelationShips().add(relationShip);
        personRepository.save(personYangjian);
    }
    @Test
    public void addRelation2() {
        personRepository.createRelation(&quot;ç‰çš‡å¤§å¸&quot;, &quot;å¦»å­&quot;, &quot;ç‹æ¯å¨˜å¨˜&quot;);
    }
}
</code></pre>
<p>åˆ›å»ºå…³ç³»ç¬¬ä¸€ç§æ–¹å¼<br>
<img src="https://imyzt.top/post-images/1719748762850.png" alt="" loading="lazy"><br>
åˆ›å»ºå…³ç³»ç¬¬äºŒç§æ–¹å¼<br>
<img src="https://imyzt.top/post-images/1719748767396.png" alt="" loading="lazy"></p>
<h1 id="å‘">å‘</h1>
<h2 id="å‘1">å‘1</h2>
<p>spring-boot-data 3.+çš„å¾ˆå¤šæ³¨è§£éƒ½æ”¹å˜äº†ï¼Œä¾‹å¦‚ï¼š</p>
<ol>
<li>åœ¨è€ç‰ˆæœ¬ä¸­æ ‡æ³¨èŠ‚ç‚¹ä½¿ç”¨çš„æ˜¯<code>@NodeEntity</code>ï¼Œæ–°ç‰ˆæœ¬è¢«æ›¿æ¢ä¸º<code>@Node(labels = &quot;person&quot;)</code></li>
<li>åœ¨è€ç‰ˆæœ¬ä¸­ï¼Œå…³ç³»çš„è¡¨è¿°æ˜¯åœ¨å…³ç³»å¯¹è±¡ä¸­é€šè¿‡<code>@RelationshipEntity</code>ã€<code>@StartNode</code>ã€<code>@EndNode</code>æ¥æè¿°ï¼Œåœ¨æ–°ç‰ˆè¿™äº›éƒ½æ²¡æœ‰äº†ã€‚å–è€Œä»£ä¹‹çš„æ˜¯åœ¨æºå¯¹è±¡ä¸­è¡¥å……å±æ€§<code>@Relationship(type = &quot;å¸ˆå‚…&quot;, direction = Relationship.Direction.OUTGOING)</code>æ¥æè¿°å…³ç³»ã€‚<br>
è€å…³ç³»ï¼š</li>
</ol>
<pre><code class="language-java">@Data
@RelationshipEntity(type = &quot;xxx&quot;)
public class PersonRelationShip {
    @Id
    @GeneratedValue
    private Long id;
    @StartNode
    private Person parent;
    @TargetNode
    private Person child;
}
</code></pre>
<p>æ–°å…³ç³»ï¼š</p>
<pre><code class="language-java">@Node(labels = &quot;person&quot;)
@Data
public class Person {
    @Id
    @GeneratedValue
    private Long id;
    @Property
    private String name;
    @Relationship(type = &quot;å¸ˆå‚…&quot;, direction = Relationship.Direction.OUTGOING)
    private List&lt;PersonRelationShip&gt; personRelationShips;
}
@Data
@RelationshipProperties
public class PersonRelationShip {
    @Id
    @GeneratedValue
    private Long id;
    @TargetNode
    private Person child;
    @Property
    private String relation;
}
</code></pre>
<h2 id="å‘2">å‘2</h2>
<p>spring-boot-data 3.+çš„<code>@Query</code>ä¸­æƒ³è¦è·å–å‚æ•°ï¼Œéœ€è¦ä½¿ç”¨ <code>$fieldName</code>ï¼Œè€Œä¸æ˜¯ <code>{0}</code> çš„æ–¹å¼ï¼Œå¦‚æœè‡ªå·±å†™çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-java">/**
    * åˆ›å»ºäººç‰©å…³ç³»
    * @param from æº
    * @param relation å…³ç³»
    * @param to ç›®æ ‡
    */
@Query(&quot;match (n:person {name: $from}),(m:person {name: $to}) &quot; +
        &quot;create (n)-[:è¥¿æ¸¸äººç‰©å…³ç³»{relation:$relation}]-&gt;(m)&quot;)
void createRelation(String from, String relation, String to);
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ä½¿ç”¨CloudflareåŠ é€ŸGithub Pages]]></title>
        <id>https://imyzt.top/post/shi-yong-cloudflare-jia-su-github-pages/</id>
        <link href="https://imyzt.top/post/shi-yong-cloudflare-jia-su-github-pages/">
        </link>
        <updated>2024-06-28T12:50:23.000Z</updated>
        <content type="html"><![CDATA[<p>ä¹‹å‰å°±æœ‰äº†è§£è¿‡Cloudflareï¼Œä½†æ˜¯ä¸€ç›´æ²¡æœ‰å»å®è·µï¼Œæœ€è¿‘äº†è§£åˆ°å®ƒæä¾›äº†å…è´¹çš„CDNå¯ä»¥åŠ é€Ÿï¼Œæ‰€ä»¥æƒ³æ‰¾ä¸ªæ•™ç¨‹æŒ‰æµç¨‹è¯•ä¸€ä¸‹ï¼Œä¸€ä¸ªæ˜¯ç¡®å®Github Pagesè®¿é—®å¤ªæ…¢äº†ï¼ˆè™½è¯´Cloudflareåœ¨å›½å†…ä¹Ÿæ²¡æœ‰èŠ‚ç‚¹...ä½†èŠèƒœäºæ— ï¼‰ï¼Œå¦ä¸€ä¸ªä¸»è¦æ˜¯ä¹Ÿå¯ä»¥å­¦ä¹ æ‹“å±•ä¸‹çŸ¥è¯†ã€‚å…¶å®ä½¿ç”¨èµ·æ¥æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯æŒºç®€å•çš„ï¼ŒåŸºæœ¬æ— è„‘æ“ä½œã€‚</p>
<ol>
<li>æ³¨å†ŒCloudflareçš„è´¦å·ï¼Œå¡«å†™ä½ çš„åŸŸåï¼Œäº¤ç»™å®ƒæ‰˜ç®¡ï¼ˆæ‰“å¼€å®˜ç½‘ï¼Œç‚¹å‡»å°±é€ï¼‰</li>
<li>æ‹·è´Cloudflareæä¾›çš„DNSè§£æï¼Œæ›¿æ¢ä½ çš„åŸŸåæœåŠ¡å•†æä¾›çš„è§£æï¼ˆæˆ‘ä½¿ç”¨çš„aliyunï¼Œåœ¨åŸŸå-ç®¡ç†-DNSè§£æï¼‰å¤„å¯æ›¿æ¢</li>
<li>ç­‰å¾…å‡ åˆ†é’Ÿï¼Œå³å¯å¤±æ•ˆã€‚</li>
</ol>
<p>ä¸Šé¢çš„æ­¥éª¤æ›´åƒæ˜¯æŠŠå¤§è±¡æ”¾è¿›å†°ç®±çš„æ­¥éª¤ï¼Œè¿‡äºç®€å•ï¼Œä¸»è¦æ˜¯ç½‘ç»œä¸Šé’ˆå¯¹æ­¤æµç¨‹æä¾›çš„ä¼˜ç§€åšå®¢æ•°ä¸èƒœæ•°ï¼Œæ²¡å¿…è¦å†äº§ç”Ÿä¸€ç¯‡é‡å¤çš„å†…å®¹ï¼Œå¹¶ä¸”æ–‡ç« ä¹Ÿä¸»è¦æ˜¯ç”¨äºè®°å½•è‡ªå·±æ¥å…¥çš„è¿‡ç¨‹å’Œé‡åˆ°çš„å‘ã€‚</p>
<p>æˆ‘çœ‹çš„åšå®¢æ˜¯ï¼š <a href="https://www.jun997.xyz/2022/05/18/62ef741104da.html">ä½¿ç”¨cdnåŠ é€ŸGithub Pagesçš„è®¿é—®é€Ÿåº¦</a></p>
<p>è·Ÿç€è¿™ä¸ªåšå®¢åŸºæœ¬å°±å¯ä»¥æŠŠåŸŸåå®Œæˆæ‰˜ç®¡ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸»è¦æ˜¯é‡åˆ°ä¸€ä¸ªå‘ï¼Œåœ¨é…ç½®å®Œæˆä¹‹åï¼Œå‘ç°æœ¬æ¥é€šè¿‡aliyunè§£æçš„ç½‘ç«™è¿˜èƒ½æ‰“å¼€ï¼Œæ‰˜ç®¡ä¹‹ååå€’æ˜¯æ‰“ä¸å¼€äº†ï¼ŒChromeæç¤ºâ€œé‡å®šå‘çš„æ¬¡æ•°è¿‡å¤šâ€ï¼Œè¿™ä¸€æ­¥ä¸»è¦æ˜¯å› ä¸ºè§£æé…ç½®çš„é—®é¢˜ï¼Œå¯ä»¥ç™»é™†Cloudflareï¼Œç„¶åå†SSL/TLSèœå•é‡Œè°ƒæ•´ä¸‹é¢çš„é…ç½®å³å¯ï¼š<br>
åŸæœ¬é€‰ä¸­çš„æ˜¯â€œçµæ´»çš„â€ï¼Œè°ƒæ•´ä¸ºâ€œä¸¥è°¨â€å³å¯ã€‚<br>
<img src="https://imyzt.top/post-images/1719579571878.png" alt="" loading="lazy"></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Neo4jå¸¸ç”¨å‡½æ•°]]></title>
        <id>https://imyzt.top/post/neo4j-chang-yong-han-shu/</id>
        <link href="https://imyzt.top/post/neo4j-chang-yong-han-shu/">
        </link>
        <updated>2024-06-26T15:05:34.000Z</updated>
        <content type="html"><![CDATA[<h1 id="å­—ç¬¦ä¸²å‡½æ•°">å­—ç¬¦ä¸²å‡½æ•°</h1>
<pre><code class="language-cql">match (n:Lianhuachi) where n.name = 'å»ç§ç”°çš„å‘å‡¹å‡¸' return n.name,substring(n.name, 0,3)
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://imyzt.top/post-images/1719414420545.png" alt="" loading="lazy"></figure>
<h1 id="aggregationèšåˆå‡½æ•°">AGGREGATIONèšåˆå‡½æ•°</h1>
<p>å’Œæ™®é€šSQLä¸€è‡´çš„å«ä¹‰</p>
<pre><code class="language-cql">match (n:Lianhuachi) return count(n),max(n.age),min(n.age),avg(n.age),sum(n.age)
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://imyzt.top/post-images/1719414601279.png" alt="" loading="lazy"></figure>
<h1 id="å…³ç³»å‡½æ•°">å…³ç³»å‡½æ•°</h1>
<pre><code class="language-cql">match (x)-[n:`è²èŠ±æ± äººç‰©å…³ç³»`]-&gt;(y) return id(n),n
</code></pre>
<figure data-type="image" tabindex="3"><img src="https://imyzt.top/post-images/1719414748513.png" alt="" loading="lazy"></figure>
<h1 id="å¤‡ä»½">å¤‡ä»½</h1>
<p>Neo4j å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://neo4j.com/docs/operations-manual/current/backup-restore/modes/">Backup modes</a></p>
<pre><code class="language-cql">âœ  bin ./neo4j-admin database dump neo4j --to-path=/tmp
2024-06-26 15:24:15.414+0000 INFO  [o.n.c.d.DumpCommand] Starting dump of database 'neo4j'
Done: 37 files, 2.993MiB processed.
2024-06-26 15:24:19.338+0000 INFO  [o.n.c.d.DumpCommand] Dump completed successfully


âœ  bin ll /tmp/ |grep &quot;neo4j.dump&quot;
-rw-r--r--  1 imyzt   wheel   305K Jun 26 23:24 neo4j.dump

</code></pre>
<h1 id="æ¢å¤">æ¢å¤</h1>
<p>Neo4j å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://neo4j.com/docs/operations-manual/current/backup-restore/restore-dump/">Restore a database dump</a></p>
<pre><code>âœ  bin ./neo4j-admin database load --from-path=/tmp/ neo4j --overwrite-destination=true
Done: 37 files, 2.993MiB processed.
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®æ¢å¤äº†è¿‡æ¥ã€‚<br>
<img src="https://imyzt.top/post-images/1719735796053.png" alt="neo4j_restore" loading="lazy"></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Neoå¸¸ç”¨å‘½ä»¤ äºŒ]]></title>
        <id>https://imyzt.top/post/neo-chang-yong-ming-ling-er/</id>
        <link href="https://imyzt.top/post/neo-chang-yong-ming-ling-er/">
        </link>
        <updated>2024-06-26T13:57:44.000Z</updated>
        <content type="html"><![CDATA[<h1 id="uniqueçº¦æŸ">UNIQUEçº¦æŸ</h1>
<p>é¿å…é‡å¤æ—¶ä½¿ç”¨ï¼ˆå§“åã€èº«ä»½è¯ä¸èƒ½é‡å¤ï¼‰</p>
<h2 id="æ—§ç‰ˆæœ¬">æ—§ç‰ˆæœ¬</h2>
<pre><code class="language-cql">create constraint on (n:Lianhuachi) assert n.name is unique
</code></pre>
<h2 id="æ–°ç‰ˆæœ¬">æ–°ç‰ˆæœ¬</h2>
<p>å¦‚æœå†æ‰§è¡Œä¸Šé¢çš„è¯­æ³•æ—¶æŠ¥é”™ï¼Œè¯´æ˜ä½ ä½¿ç”¨çš„æ˜¯æ–°ç‰ˆæœ¬çš„Neo4jï¼Œå˜æ›´äº†å‘½ä»¤è¯­æ³•ã€‚</p>
<pre><code class="language-cql">create constraint uniq_name for (n:Lianhuachi) require n.name is unique
</code></pre>
<p>åœ¨åŠ äº†å”¯ä¸€ç´¢å¼•åï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ·»åŠ é‡å¤æ•°æ®æ—¶ä¼šæŠ¥é”™ï¼š<br>
<img src="https://imyzt.top/post-images/1719409875933.png" alt="" loading="lazy"></p>
<h2 id="åˆ é™¤å”¯ä¸€çº¦æŸ">åˆ é™¤å”¯ä¸€çº¦æŸ</h2>
<pre><code class="language-cql">drop constraint uniq_name 
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨åˆ é™¤ä¹‹åå†è¿›è¡Œæ·»åŠ ï¼Œæ˜¯å¯ä»¥æ·»åŠ è¿›å»çš„ã€‚</p>
<pre><code class="language-cql">create (n:Lianhuachi {name: &quot;æˆ‘æ˜¯é‡å†œ&quot;, &quot;field&quot;: &quot;test&quot;}) return n
match (n:Lianhuachi {name: &quot;æˆ‘æ˜¯é‡å†œ&quot;&quot;}) return n
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://imyzt.top/post-images/1719410056076.png" alt="" loading="lazy"></figure>
<h1 id="distinctå»é‡">distinctå»é‡</h1>
<p>å’ŒSQLä¸€è‡´ï¼Œå¯¹å†…å®¹è¿›è¡Œå»é‡</p>
<pre><code class="language-cql">match (n:Lianhuachi) return distinct(n.name)
</code></pre>
]]></content>
    </entry>
</feed>